{"type":"root","children":[{"type":"element","tag":"dimertitle","props":{},"children":[{"type":"text","value":"The Reddit Fire"}]},{"type":"element","tag":"h1","props":{"id":"the-reddit-fire"},"children":[{"type":"element","tag":"a","props":{"href":"#the-reddit-fire","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"The Reddit Fire"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Recently a "},{"type":"element","tag":"a","props":{"href":"https://www.reddit.com/r/node/comments/7x3afi/anyone_using_adonisjs_in_production/"},"children":[{"type":"text","value":"thread on Reddit"}]},{"type":"text","value":" asking whether "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"AdonisJs is ready for production and not?"}]},{"type":"text","value":" caught my attention towards the weird reasons shared by users on the thread."}]},{"type":"element","tag":"div","props":{"className":["toc-container"]},"children":[{"type":"element","tag":"h2","props":{},"children":[{"type":"text","value":"Table of contents"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#the-test-runner"},"children":[{"type":"text","value":"The test runner"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#the-use-method"},"children":[{"type":"text","value":"The use method"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#you-cannot-maintain-it"},"children":[{"type":"text","value":"You cannot maintain it"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#mmmm-adonis-is-slower-than-express"},"children":[{"type":"text","value":"Mmmm, Adonis is slower than express"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"One of the most popular ones was:"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Most of the packages are hand-written from scratch and that’s why the framework is not production ready."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Before I really get into the specifics, I want to share the philosophy of the framework."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"AdonisJs is not a toolset, it’s an experience. For example:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Android"}]},{"type":"text","value":" gives you a software and then all these companies, bundle that software into fucked up hardware."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Whereas "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Apple"}]},{"type":"text","value":" decided to ship the experience of using a mobile device, they don’t care, whether they created everything by hand or they outsourced it."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now let’s dive into the criticisms."}]},{"type":"element","tag":"h2","props":{"id":"the-test-runner"},"children":[{"type":"element","tag":"a","props":{"href":"#the-test-runner","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"The test runner"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A common complaint is related to "},{"type":"element","tag":"a","props":{"href":"https://github.com/thetutlage/japa"},"children":[{"type":"text","value":"japa"}]},{"type":"text","value":", the test runner used by AdonisJs to write and run tests. Before writing the first line of the code, here were my requirements."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Ability to write test using a concise syntax and avoiding too much nesting."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Controlling the test flow, so that framework can hook into specific areas and offer better testing experience."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Clean "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"cli"}]},{"type":"text","value":" interface to filter and run tests."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Extendible testing API, so that the framework users can plug add-ons when they need them. The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"trait"}]},{"type":"text","value":" is an example of same."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"So I looked for all popular options."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Mocha"}]},{"type":"text","value":" - Too much is spitted in globals like "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"before"}]},{"type":"text","value":", "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"describe"}]},{"type":"text","value":", "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"it"}]},{"type":"text","value":" and so on. Also mocha comes with too much and half of it is useless for Adonis, for example, It’s a browser-friendly test runner and Adonis is a server framework."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Ava"}]},{"type":"text","value":" - Ava doesn’t have any API, which can allow me to register tests and then call some function to execute those tests. If I decided to stick with "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Ava"}]},{"type":"text","value":", then I will have to hack upon their CLI commands and call them using "},{"type":"element","tag":"a","props":{"href":"https://nodejs.org/dist/latest-v9.x/docs/api/child_process.html#child_process_child_process_exec_command_options_callback"},"children":[{"type":"text","value":"child_process.exec"}]},{"type":"text","value":" method."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Jest"}]},{"type":"text","value":" - The same story as Ava, I cannot change the testing syntax or add new features."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"These tools are great, but they were not written to be embedded into a framework, they are supposed to be used on their own."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now Japa is an "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"API first"}]},{"type":"text","value":" testing framework, it doesn’t care where and how your tests are written. Which means AdonisJs can do all sort of custom stuff and then register tests with Japa and execute them."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Here’s a working example."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-js","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">const</span> Emitter <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'events'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> Test<span class=\"token punctuation\">,</span> Runner<span class=\"token punctuation\">,</span> Group<span class=\"token punctuation\">,</span> reporters <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'japa/api'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Some global options</span>\n<span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  timeout<span class=\"token operator\">:</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">,</span>\n  emitter<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Emitter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Your test</span>\n<span class=\"token keyword\">const</span> test <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello world'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">assert</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  assert<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span> <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Add test to some group</span>\n<span class=\"token keyword\">const</span> group <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Group</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span>\ngroup<span class=\"token punctuation\">.</span><span class=\"token function\">addTest</span><span class=\"token punctuation\">(</span>test<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Initiate runner</span>\n<span class=\"token keyword\">const</span> runner <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Runner</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>group<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> reporters<span class=\"token punctuation\">.</span>list<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Run tests</span>\nrunner\n  <span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'tests over'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'tests failed'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"As you can see, "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"there are no command line commands"}]},{"type":"text","value":" to execute, "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"there are no globals"}]},{"type":"text","value":". If you want me to leave this pure API and hack upon the existing test runners, which are not supposed to be embedded, then I am sorry, AdonisJs is not for you."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This philosophy is true for everything I wrote by hand. In places where existing tools are best suited, I have used them and "},{"type":"element","tag":"a","props":{"href":"https://github.com/tj/commander.js/"},"children":[{"type":"text","value":"commander.js"}]},{"type":"text","value":" is an example of same, which is used by Ace."}]},{"type":"element","tag":"h2","props":{"id":"the-use-method"},"children":[{"type":"element","tag":"a","props":{"href":"#the-use-method","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"The use method"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Another criticism is the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"use"}]},{"type":"text","value":" method. Now Javascript never had any standards on module loading or dependency management. That’s why Node.js came-up with "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"require"}]},{"type":"text","value":" and I with "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"use"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I agree the custom implementation of module loading is painful since there is no support for autocomplete by editors."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Again as there were no standards, the editor chooses to implement the autocomplete for popular patterns. And once ES6 "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"import/export"}]},{"type":"text","value":" will be a stable thing in Node.js. The IoC container of the framework will use it over the custom "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"use"}]},{"type":"text","value":" method."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The IoC container will use the "},{"type":"element","tag":"a","props":{"href":"https://nodejs.org/dist/latest-v9.x/docs/api/esm.html#esm_loader_hooks"},"children":[{"type":"text","value":"loader hooks"}]},{"type":"text","value":" to resolve dependencies and hence you will be able to use "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"import"}]},{"type":"text","value":" statements over "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"use"}]},{"type":"text","value":" method. "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Till then it’s a trade off"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h2","props":{"id":"you-cannot-maintain-it"},"children":[{"type":"element","tag":"a","props":{"href":"#you-cannot-maintain-it","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"You cannot maintain it"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"How do you know? If you think maintaining a code base is all about more people, then you got it wrong."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A popular testing framework "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Mocha"}]},{"type":"text","value":" is looking for maintainers, because the guy who created it has moved on and expecting everyone else to share the same passion for the code base is false."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"src":"https://res.cloudinary.com/adonis-js/image/upload/q_auto,w_auto,f_auto,fl_lossy/v1588694377/adonisjs.com/blog/e6bec03e-30d0-4708-8eb3-0031853acf88_mtjy0r.webp"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Yes, I can also move on with something else, but until then maintaining all these reports is something that keeps me awake and happy."}]},{"type":"element","tag":"h2","props":{"id":"mmmm-adonis-is-slower-than-express"},"children":[{"type":"element","tag":"a","props":{"href":"#mmmm-adonis-is-slower-than-express","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Mmmm, Adonis is slower than express"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"First, "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"micro benchmarking is for suckers"}]},{"type":"text","value":", but still here’s how Adonis slim boilerplate performs in comparison to ExpressJs."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Again, there are many another framework, which will perform better than AdonisJs and speed is not the main concern for me, until it’s not a bottleneck. So I am not going to talk about it at all."}]},{"type":"element","tag":"div","props":{"className":["embed","youtube"]},"children":[{"type":"element","tag":"iframe","props":{"src":"https://www.youtube.com/embed/P10Bpz82Rpc","width":"100%","height":"400","frameborder":"none","allowfullscreen":true},"children":[]}]}]}
