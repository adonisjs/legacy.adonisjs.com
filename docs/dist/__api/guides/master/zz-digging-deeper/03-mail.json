{"type":"root","children":[{"type":"element","tag":"dimertitle","props":{},"children":[{"type":"text","value":"Mail"}]},{"type":"element","tag":"h1","props":{"id":"mail"},"children":[{"type":"element","tag":"a","props":{"href":"#mail","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Mail"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"AdonisJS ships with an official package for sending emails. It internally uses "},{"type":"element","tag":"a","props":{"href":"https://nodemailer.com/about/"},"children":[{"type":"text","value":"nodemailer"}]},{"type":"text","value":" to send emails but "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"removes the boilerplate"}]},{"type":"text","value":" for manually constructing transports and "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"allows trapping emails during tests"}]},{"type":"text","value":", so that they are not sent to the real recipients."}]},{"type":"element","tag":"div","props":{"className":["toc-container"]},"children":[{"type":"element","tag":"h2","props":{},"children":[{"type":"text","value":"Table of contents"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#setup"},"children":[{"type":"text","value":"Setup"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#invoke-generator"},"children":[{"type":"text","value":"Invoke Generator"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#supported-drivers"},"children":[{"type":"text","value":"Supported drivers"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#configuration"},"children":[{"type":"text","value":"Configuration"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#points-to-note"},"children":[{"type":"text","value":"Points to note"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#mailgun-config"},"children":[{"type":"text","value":"Mailgun config"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#sparkpost-config"},"children":[{"type":"text","value":"Sparkpost config"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#usage"},"children":[{"type":"text","value":"Usage"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#defer-email-sending"},"children":[{"type":"text","value":"Defer email sending"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#creating-email-templates"},"children":[{"type":"text","value":"Creating email templates"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#sending-attachments"},"children":[{"type":"text","value":"Sending attachments"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#cid-attachments"},"children":[{"type":"text","value":"CID attachments"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#points-to-note-1"},"children":[{"type":"text","value":"Points to note"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#switching-mailers-at-runtime"},"children":[{"type":"text","value":"Switching mailers at runtime"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#smtp-server-previews"},"children":[{"type":"text","value":"SMTP server previews"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#debugging-email-calls"},"children":[{"type":"text","value":"Debugging email calls"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By the end of this guide, you will know:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"How to install and configure the mail package"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"How to create and use multiple mailers"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Trapping emails during tests"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Previewing emails on a dummy SMTP server"}]}]},{"type":"element","tag":"h2","props":{"id":"setup"},"children":[{"type":"element","tag":"a","props":{"href":"#setup","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Setup"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Install the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"@adonisjs/mail"}]},{"type":"text","value":" package from npm registry using the following command."}]},{"type":"element","tag":"div","props":{"className":["alert","alert-note"]},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"@adonisjs/mail"}]},{"type":"text","value":" package relies on "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"@adonisjs/view"}]},{"type":"text","value":" package. Make sure the view package is installed and configured correctly."}]}]},{"type":"element","tag":"div","props":{"className":["tabs"]},"children":[{"type":"element","tag":"div","props":{"className":["tab-head"]},"children":[{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{"dataTitle":"tab-1"},"children":[{"type":"text","value":"npm"}]},{"type":"element","tag":"li","props":{"dataTitle":"tab-2"},"children":[{"type":"text","value":"yarn"}]}]}]},{"type":"element","tag":"div","props":{"className":["tab-body"]},"children":[{"type":"element","tag":"div","props":{"className":["tab-item"],"id":"tab-1"},"children":[{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"npm"}]},{"type":"element","tag":"pre","props":{"className":["language-sh","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token function\">npm</span> i @adonisjs/mail@alpha\n"}]}]}]}]},{"type":"element","tag":"div","props":{"className":["tab-item"],"id":"tab-2"},"children":[{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"yarn"}]},{"type":"element","tag":"pre","props":{"className":["language-sh","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token function\">yarn</span> <span class=\"token function\">add</span> @adonisjs/mail@alpha\n"}]}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"invoke-generator"},"children":[{"type":"element","tag":"a","props":{"href":"#invoke-generator","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Invoke Generator"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"AdonisJS packages can configure themselves by running the post install instructions. Run the following command to setup "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"@adonisjs/mail"}]},{"type":"text","value":" package."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-sh","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"node ace invoke @adonisjs/mail\n\n<span class=\"token comment\">#   create    config/mail.ts</span>\n<span class=\"token comment\">#   create    contracts/mail.ts</span>\n<span class=\"token comment\">#   update    .env</span>\n<span class=\"token comment\">#   update    tsconfig.json { types += @adonisjs/mail }</span>\n<span class=\"token comment\">#   update    .adonisrc.json { providers += @adonisjs/mail }</span>\n<span class=\"token comment\"># âœ” create    ace-manifest.json</span>\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"supported-drivers"},"children":[{"type":"element","tag":"a","props":{"href":"#supported-drivers","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Supported drivers"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The mail module out of the box supports the following drivers."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"smtp"}]},{"type":"text","value":" ( Uses the SMTP protocol )"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"ses"}]},{"type":"text","value":" ( Uses AWS SES )"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"mailgun"}]},{"type":"text","value":" ( Uses mailgun service )"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"sparkpost"}]},{"type":"text","value":" ( Uses sparkpost service )"}]}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"element","tag":"a","props":{"href":"#configuration","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The configuration for the mail package is stored inside the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"config/mail.ts"}]},{"type":"text","value":" file. Inside the config file, you can define one or more mailers, along with the default mailer to use."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">import</span> Env <span class=\"token keyword\">from</span> <span class=\"token string\">'@ioc:Adonis/Core/Env'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> MailConfig <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@ioc:Adonis/Addons/Mail'</span>\n\n<span class=\"token keyword\">const</span> mailConfig<span class=\"token operator\">:</span> MailConfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/*\n  |--------------------------------------------------------------------------\n  | DEFAULT MAILER\n  |--------------------------------------------------------------------------\n  */</span>\n  mailer<span class=\"token operator\">:</span> <span class=\"token string\">'smtp'</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token comment\">/*\n  |--------------------------------------------------------------------------\n  | MAILERS LIST\n  |--------------------------------------------------------------------------\n  */</span>\n  mailers<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    smtp<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      driver<span class=\"token operator\">:</span> <span class=\"token string\">'smtp'</span><span class=\"token punctuation\">,</span>\n      host<span class=\"token operator\">:</span> Env<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'SMTP_HOST'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n      port<span class=\"token operator\">:</span> Env<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'SMTP_PORT'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    ses<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      driver<span class=\"token operator\">:</span> <span class=\"token string\">'ses'</span><span class=\"token punctuation\">,</span>\n      apiVersion<span class=\"token operator\">:</span> <span class=\"token string\">'2010-12-01'</span><span class=\"token punctuation\">,</span>\n      key<span class=\"token operator\">:</span> Env<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'SES_ACCESS_KEY'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n      secret<span class=\"token operator\">:</span> Env<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'SES_ACCESS_SECRET'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n      region<span class=\"token operator\">:</span> Env<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'SES_REGION'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n      sslEnabled<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      sendingRate<span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span>\n      maxConnections<span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    mailgun<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      driver<span class=\"token operator\">:</span> <span class=\"token string\">'mailgun'</span><span class=\"token punctuation\">,</span>\n      baseUrl<span class=\"token operator\">:</span> <span class=\"token string\">'https://api.mailgun.net/v3'</span><span class=\"token punctuation\">,</span>\n      key<span class=\"token operator\">:</span> Env<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'MAILGUN_API_KEY'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    sparkpost<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      driver<span class=\"token operator\">:</span> <span class=\"token string\">'sparkpost'</span><span class=\"token punctuation\">,</span>\n      baseUrl<span class=\"token operator\">:</span> <span class=\"token string\">'https://api.sparkpost.com/api/v1'</span><span class=\"token punctuation\">,</span>\n      key<span class=\"token operator\">:</span> Env<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'SPARKPOST_API_KEY'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> mailConfig\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"points-to-note"},"children":[{"type":"element","tag":"a","props":{"href":"#points-to-note","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Points to note"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can create multiple mailers using the same underlying driver. For example: A mailer to send promotional emails and another one to send transactional."}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When defining a new mailer inside the config file, it needs to be first registered inside "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"contracts/mail.ts"}]},{"type":"text","value":" file. Otherwise, the typescript compiler will complain."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">declare</span> <span class=\"token keyword\">module</span> <span class=\"token string\">'@ioc:Adonis/Addons/Mail'</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> MailDrivers <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@ioc:Adonis/Addons/Mail'</span>\n\n  <span class=\"token keyword\">interface</span> <span class=\"token class-name\">MailersList</span> <span class=\"token punctuation\">{</span>\n    smtp<span class=\"token operator\">:</span> MailDrivers<span class=\"token punctuation\">[</span><span class=\"token string\">'smtp'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    ses<span class=\"token operator\">:</span> MailDrivers<span class=\"token punctuation\">[</span><span class=\"token string\">'ses'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    mailgun<span class=\"token operator\">:</span> MailDrivers<span class=\"token punctuation\">[</span><span class=\"token string\">'mailgun'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    sparkpost<span class=\"token operator\">:</span> MailDrivers<span class=\"token punctuation\">[</span><span class=\"token string\">'sparkpost'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To switch between mailers, you can use "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Mail.use('<MAILER NAME>')"}]},{"type":"text","value":" method."}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Finally, feel free to remove the configuration for the mailers you are not planning to use."}]}]}]},{"type":"element","tag":"h3","props":{"id":"mailgun-config"},"children":[{"type":"element","tag":"a","props":{"href":"#mailgun-config","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Mailgun config"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The mailgun configuration block optionally accepts the following options."}]},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"Config option"}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"Mailgun variant"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"oTag"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"o:tag"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"oDeliverytime"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"o:deliverytime"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"oTestMode"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"o:testmode"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"oTracking"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"o:tracking"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"oTrackingClick"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"o:tracking-clicks"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"oTrackingOpens"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"o:tracking-opens"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"oDkim"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"o:dkim"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"headers"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"h:"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"All of the options except "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"oDkim"}]},{"type":"text","value":" can be passed during the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Mail.send"}]},{"type":"text","value":" call as well."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">await</span> Mail<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mailgun'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  message<span class=\"token punctuation\">.</span><span class=\"token function\">subject</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Welcome Onboard!'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  oTag<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'signup'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"sparkpost-config"},"children":[{"type":"element","tag":"a","props":{"href":"#sparkpost-config","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Sparkpost config"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The sparkpost configuration block optionally accepts the following options."}]},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"Config option"}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"Sparkpost variant"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"startTime"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"start_time"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"openTracking"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"open_tracking"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"clickTracking"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"click_tracking"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"transactional"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"transactional"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"sandbox"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"sandbox"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"skipSuppression"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"skip_suppression"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"ipPool"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"ip_pool"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"All of the configuration options can also be defined at runtime during the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Mail.send"}]},{"type":"text","value":" call."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">await</span> Mail<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sparkpost'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  message<span class=\"token punctuation\">.</span><span class=\"token function\">subject</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Welcome Onboard!'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  transaction<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  openTracking<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"usage"},"children":[{"type":"element","tag":"a","props":{"href":"#usage","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Once done with the setup, you can import the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Mail"}]},{"type":"text","value":" module and send emails using the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Mail.send"}]},{"type":"text","value":" method."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">import</span> Mail <span class=\"token keyword\">from</span> <span class=\"token string\">'@ioc:Adonis/Addons/Mail'</span>\n\nMail<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  message\n    <span class=\"token punctuation\">.</span><span class=\"token keyword\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">'info@example.com'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span><span class=\"token string\">'virk@adonisjs.com'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">subject</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Welcome Onboard!'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">htmlView</span><span class=\"token punctuation\">(</span><span class=\"token string\">'emails/welcome'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'Virk'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Mail.send"}]},{"type":"text","value":" method accepts a callback function."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Inside the callback, you can configure the mail message by calling the appropriate methods."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"At bare minimum, you must define "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"from"}]},{"type":"text","value":", "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"to"}]},{"type":"text","value":", "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"subject"}]},{"type":"text","value":" and the content of the email using the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"htmlView"}]},{"type":"text","value":" method."}]}]},{"type":"element","tag":"h3","props":{"id":"defer-email-sending"},"children":[{"type":"element","tag":"a","props":{"href":"#defer-email-sending","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Defer email sending"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Most of the times, you will be sending emails in respond to some action. For example: Send email after user registration or during the password reset flow."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">import</span> User <span class=\"token keyword\">from</span> <span class=\"token string\">'App/Models/User'</span>\n<span class=\"token keyword\">import</span> Mail <span class=\"token keyword\">from</span> <span class=\"token string\">'@ioc:Adonis/Addons/Mail'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UsersController</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">async</span> <span class=\"token function\">store</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> User<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"dimer-highlight-code-line\">    <span class=\"token keyword\">await</span> Mail<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"dimer-highlight-code-line\">      <span class=\"token comment\">// ...configure message</span></span><span class=\"dimer-highlight-code-line\">    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></span>\n    <span class=\"token keyword\">return</span> user\n  <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In the above example, the HTTP request to create the user will have to wait until the email is sent and hence makes your application appear slower."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To change this behavior, you need to make sure that the email is sent in the background and not during the HTTP request and the same can be achieved using the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Mail.sendLater"}]},{"type":"text","value":" method."}]},{"type":"element","tag":"div","props":{"className":["alert","alert-note"]},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Mail.sendLater"}]},{"type":"text","value":" method uses an in-memory queue to send emails in the background. For critical emails, you may want to use a real queue server, since an in-memory queue will loose all the jobs when server goes down."}]}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UsersController</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">async</span> <span class=\"token function\">store</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> User<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"dimer-highlight-code-line\">    <span class=\"token comment\">// Pushed to in-memory queue</span></span><span class=\"dimer-highlight-code-line\">    <span class=\"token keyword\">await</span> Mail<span class=\"token punctuation\">.</span><span class=\"token function\">sendLater</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span>      <span class=\"token comment\">// ...configure message</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> user\n  <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span>\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"creating-email-templates"},"children":[{"type":"element","tag":"a","props":{"href":"#creating-email-templates","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Creating email templates"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can make use of standard edge templates for defining email content. The templates lives inside the same "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"resources/views"}]},{"type":"text","value":" directory. For better organization, you can move them inside a sub-directory called "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"emails"}]},{"type":"text","value":". For example:"}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-sh","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"node ace make:view emails/welcome\n\n<span class=\"token comment\"># âœ”  create    resources/views/emails/welcome.edge</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Open the newly created template file and paste following contents inside it."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-edge","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token other\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span> Welcome</span> <span class=\"token mustache\"><span class=\"token punctuation\">{{</span> user.fullName <span class=\"token punctuation\">}}</span></span> <span class=\"token other\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>\n  &lt;a href=\"</span><span class=\"token mustache\"><span class=\"token punctuation\">{{</span> url <span class=\"token punctuation\">}}</span></span><span class=\"token other\">\">Click here<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span> to verify your email address.\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span></span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Finally, you can use this view as the content for the email by calling the following method."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">await</span> Mail<span class=\"token punctuation\">.</span><span class=\"token function\">sendLater</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  message<span class=\"token punctuation\">.</span><span class=\"token function\">htmlView</span><span class=\"token punctuation\">(</span><span class=\"token string\">'emails/welcome'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    user<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> fullName<span class=\"token operator\">:</span> <span class=\"token string\">'Some Name'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    url<span class=\"token operator\">:</span> <span class=\"token string\">'https://your-app.com/verification-url'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Similarly, you can also define the plain text content, along with the content for the Apple watch."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"Plain text"}]},{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"message<span class=\"token punctuation\">.</span><span class=\"token function\">textView</span><span class=\"token punctuation\">(</span><span class=\"token string\">'emails/welcome.plain'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"Apple watch"}]},{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"message<span class=\"token punctuation\">.</span><span class=\"token function\">watchView</span><span class=\"token punctuation\">(</span><span class=\"token string\">'emails/welcome.watch'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"sending-attachments"},"children":[{"type":"element","tag":"a","props":{"href":"#sending-attachments","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Sending attachments"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can send attachments in email using the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"message.attach"}]},{"type":"text","value":" or "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"message.embed"}]},{"type":"text","value":" methods."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">import</span> Application <span class=\"token keyword\">from</span> <span class=\"token string\">'@ioc:Adonis/Core/Application'</span>\n\n<span class=\"token keyword\">await</span> Mail<span class=\"token punctuation\">.</span><span class=\"token function\">sendLater</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  message<span class=\"token punctuation\">.</span><span class=\"token function\">attach</span><span class=\"token punctuation\">(</span>Application<span class=\"token punctuation\">.</span><span class=\"token function\">publicPath</span><span class=\"token punctuation\">(</span><span class=\"token string\">'receipt.png'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"message.attach"}]},{"type":"text","value":" method needs an absolute path to the file."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Application.publicPath"}]},{"type":"text","value":" returns an absolute path for the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" directory inside your project root."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"public"}]},{"type":"text","value":" directory is used just as an example. You can attach files from any directory."}]}]},{"type":"element","tag":"h3","props":{"id":"cid-attachments"},"children":[{"type":"element","tag":"a","props":{"href":"#cid-attachments","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"CID attachments"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There are "},{"type":"element","tag":"a","props":{"href":"https://blog.mailtrap.io/embedding-images-in-html-email-have-the-rules-changed"},"children":[{"type":"text","value":"multiple ways"}]},{"type":"text","value":" to render images inside the email body. One of them is sending the image as an attachment and then adding it to the HTML using it's Content-Id (CID)."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">await</span> Mail<span class=\"token punctuation\">.</span><span class=\"token function\">sendLater</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  message<span class=\"token punctuation\">.</span><span class=\"token function\">embed</span><span class=\"token punctuation\">(</span>\n    Application<span class=\"token punctuation\">.</span><span class=\"token function\">publicPath</span><span class=\"token punctuation\">(</span><span class=\"token string\">'receipt.png'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'a-unique-id-for-the-attachment'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"Email template"}]},{"type":"element","tag":"pre","props":{"className":["language-edge","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token other\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>cid:a-unique-id-for-the-attachment<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></span>\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"points-to-note-1"},"children":[{"type":"element","tag":"a","props":{"href":"#points-to-note-1","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Points to note"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"You have to use "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"message.embed"}]},{"type":"text","value":" method and not "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"message.attach"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Each embedded image must have a unique id, so that you can later reference it inside the template."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"img[src]"}]},{"type":"text","value":" needs the unique id, along with the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"cid:"}]},{"type":"text","value":" prefix."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Learn more about "},{"type":"element","tag":"a","props":{"href":"https://blog.mailtrap.io/embedding-images-in-html-email-have-the-rules-changed/#CID_attachments_or_embedding_an_image_using_MIME_object"},"children":[{"type":"text","value":"CID attachments"}]},{"type":"text","value":"."}]}]},{"type":"element","tag":"h2","props":{"id":"switching-mailers-at-runtime"},"children":[{"type":"element","tag":"a","props":{"href":"#switching-mailers-at-runtime","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Switching mailers at runtime"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can make use of the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Mail.use()"}]},{"type":"text","value":" method to switch between the mailers."}]},{"type":"element","tag":"div","props":{"className":["alert","alert-note"]},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"use"}]},{"type":"text","value":" method accepts the mailer name and not the driver name. Remember, you can create multiple mailers using the same underlying driver."}]}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Mail<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mailgun'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\nMail<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">'smtp'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"smtp-server-previews"},"children":[{"type":"element","tag":"a","props":{"href":"#smtp-server-previews","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"SMTP server previews"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Emails are tricky and hence there are dozens of tools/products to help you find issues with your emails. AdonisJS also provides a handy way to test your emails by sending them to a "},{"type":"element","tag":"a","props":{"href":"https://ethereal.email/"},"children":[{"type":"text","value":"dummy SMTP server"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Consider the following example:"}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> url <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> Mail<span class=\"token punctuation\">.</span><span class=\"token function\">preview</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  message\n    <span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span>email<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token keyword\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">'info@example.com'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">subject</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Welcome Onboard!'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">htmlView</span><span class=\"token punctuation\">(</span><span class=\"token string\">'emails/welcome'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Preview url: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>url<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"You just need to replace the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Mail.send"}]},{"type":"text","value":" method with the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Mail.preview"}]},{"type":"text","value":" method."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The response contains the URL to view the email on "},{"type":"element","tag":"a","props":{"href":"https://ethereal.email"},"children":[{"type":"text","value":"https://ethereal.email"}]},{"type":"text","value":"."}]}]},{"type":"element","tag":"h2","props":{"id":"debugging-email-calls"},"children":[{"type":"element","tag":"a","props":{"href":"#debugging-email-calls","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Debugging email calls"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The mail module emits "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"adonis:mail:sent"}]},{"type":"text","value":" event that you can listen to observe email calls. Let's begin by creating "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"start/events.ts"}]},{"type":"text","value":" file by running the following ace command."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"node ace make<span class=\"token operator\">:</span>prldfile events\n# âœ”  create    start<span class=\"token operator\">/</span>events<span class=\"token punctuation\">.</span>ts\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Open the newly created file and paste the following contents inside it."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"start/events.ts"}]},{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">import</span> Event <span class=\"token keyword\">from</span> <span class=\"token string\">'@ioc:Adonis/Core/Event'</span>\n<span class=\"token keyword\">import</span> Mail <span class=\"token keyword\">from</span> <span class=\"token string\">'@ioc:Adonis/Addons/Mail'</span>\n\nEvent<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'adonis:mail:sent'</span><span class=\"token punctuation\">,</span> Mail<span class=\"token punctuation\">.</span>prettyPrint<span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now, if you send an email, it will be pretty printed on the terminal."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"src":"https://res.cloudinary.com/adonis-js/image/upload/q_auto,w_700,f_auto,fl_lossy/v1594797377/adonisjs.com/adonis-mail-event-pretty-print.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Mail.prettyPrint"}]},{"type":"text","value":" method is just one way to handle the event. You are free to define your own event listener and handle the event. The event listener receives only a single argument of "},{"type":"element","tag":"a","props":{"href":"https://github.com/adonisjs/mail/blob/develop/adonis-typings/mail.ts#L486"},"children":[{"type":"text","value":"MailEventData"}]},{"type":"text","value":" type."}]}]}
