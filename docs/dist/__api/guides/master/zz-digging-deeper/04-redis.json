{"type":"root","children":[{"type":"element","tag":"dimertitle","props":{},"children":[{"type":"text","value":"Redis"}]},{"type":"element","tag":"h1","props":{"id":"redis"},"children":[{"type":"element","tag":"a","props":{"href":"#redis","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Redis"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"AdonisJS has its own first party package for working with a Redis database. It internally wraps "},{"type":"element","tag":"a","props":{"href":"https://github.com/luin/ioredis"},"children":[{"type":"text","value":"ioredis"}]},{"type":"text","value":" but improves the "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"pub/sub layer"}]},{"type":"text","value":" and provides first class support for "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"connections management"}]},{"type":"text","value":" and "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"health checks"}]},{"type":"text","value":"."}]},{"type":"element","tag":"div","props":{"className":["toc-container"]},"children":[{"type":"element","tag":"h2","props":{},"children":[{"type":"text","value":"Table of contents"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#setup"},"children":[{"type":"text","value":"Setup"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#invoke-generator"},"children":[{"type":"text","value":"Invoke Generator"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#configuration"},"children":[{"type":"text","value":"Configuration"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#usage"},"children":[{"type":"text","value":"Usage"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#pubsub"},"children":[{"type":"text","value":"Pub/Sub"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#pattern-pubsub"},"children":[{"type":"text","value":"Pattern pub/sub"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#health-checks"},"children":[{"type":"text","value":"Health Checks"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#closing-connections"},"children":[{"type":"text","value":"Closing connections"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#quit"},"children":[{"type":"text","value":"quit"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#disconnect"},"children":[{"type":"text","value":"disconnect"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#quitall"},"children":[{"type":"text","value":"quitAll"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#disconnectall"},"children":[{"type":"text","value":"disconnectAll"}]}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By the end of this guide, you will know:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"How to setup the redis package"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"How to make use of Redis pub/sub system"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"How to enable health checks"}]}]},{"type":"element","tag":"h2","props":{"id":"setup"},"children":[{"type":"element","tag":"a","props":{"href":"#setup","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Setup"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Install the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"@adonisjs/redis"}]},{"type":"text","value":" package from npm registry using the following command."}]},{"type":"element","tag":"div","props":{"className":["tabs"]},"children":[{"type":"element","tag":"div","props":{"className":["tab-head"]},"children":[{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{"dataTitle":"tab-1"},"children":[{"type":"text","value":"npm"}]},{"type":"element","tag":"li","props":{"dataTitle":"tab-2"},"children":[{"type":"text","value":"yarn"}]}]}]},{"type":"element","tag":"div","props":{"className":["tab-body"]},"children":[{"type":"element","tag":"div","props":{"className":["tab-item"],"id":"tab-1"},"children":[{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"npm"}]},{"type":"element","tag":"pre","props":{"className":["language-sh","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token function\">npm</span> i @adonisjs/redis@alpha\n"}]}]}]}]},{"type":"element","tag":"div","props":{"className":["tab-item"],"id":"tab-2"},"children":[{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"yarn"}]},{"type":"element","tag":"pre","props":{"className":["language-sh","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token function\">yarn</span> <span class=\"token function\">add</span> @adonisjs/redis@alpha\n"}]}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"invoke-generator"},"children":[{"type":"element","tag":"a","props":{"href":"#invoke-generator","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Invoke Generator"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"AdonisJS packages can configure themselves by running the post install instructions. Run the following command to setup "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"@adonisjs/redis"}]},{"type":"text","value":" package."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-sh","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"node ace invoke @adonisjs/redis\n\n<span class=\"token comment\">#    create    config/redis.ts</span>\n<span class=\"token comment\">#    create    contracts/redis.ts</span>\n<span class=\"token comment\">#    update    .env</span>\n<span class=\"token comment\">#    update    tsconfig.json { types += @adonisjs/redis }</span>\n<span class=\"token comment\">#    update    .adonisrc.json { providers += @adonisjs/redis }</span>\n<span class=\"token comment\"># âœ”  create    ace-manifest.json</span>\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"configuration"},"children":[{"type":"element","tag":"a","props":{"href":"#configuration","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The configuration for redis is stored inside "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"config/redis.ts"}]},{"type":"text","value":" file. You can define one or more named connections inside this file and their lifecycle will be managed automatically."}]},{"type":"element","tag":"div","props":{"className":["alert","alert-note"]},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When adding new connections, make sure to first define them inside "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"contracts/redis.ts"}]},{"type":"text","value":" file. Otherwise, the Typescript static compiler will complain about the unknown connections."}]}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token punctuation\">{</span>\n  connection<span class=\"token operator\">:</span> Env<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'REDIS_CONNECTION'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'local'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token string\">'local'</span><span class=\"token punctuation\">,</span>\n  connections<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    local<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      host<span class=\"token operator\">:</span> Env<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'REDIS_HOST'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'127.0.0.1'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n      port<span class=\"token operator\">:</span> Env<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'REDIS_PORT'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'6379'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n      password<span class=\"token operator\">:</span> Env<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'REDIS_PASSWORD'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n      db<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n      keyPrefix<span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"usage"},"children":[{"type":"element","tag":"a","props":{"href":"#usage","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Usage"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Once the setup has been done, you can import the module and execute the redis commands."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">import</span> Redis <span class=\"token keyword\">from</span> <span class=\"token string\">'@ioc:Adonis/Addons/Redis'</span>\n\n<span class=\"token keyword\">await</span> Redis<span class=\"token punctuation\">.</span><span class=\"token keyword\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'bar'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> value <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> Redis<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"All of the method from "},{"type":"element","tag":"a","props":{"href":"https://github.com/luin/ioredis"},"children":[{"type":"text","value":"ioredis"}]},{"type":"text","value":" are supported."}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can use the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Redis.connection"}]},{"type":"text","value":" method to execute commands on a specific connection."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Redis<span class=\"token punctuation\">.</span><span class=\"token function\">connection</span><span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span>\n"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The connections are only created once (on the first use) and then re-used for the lifecycle of the process."}]}]}]},{"type":"element","tag":"h2","props":{"id":"pubsub"},"children":[{"type":"element","tag":"a","props":{"href":"#pubsub","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Pub/Sub"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Redis forces you to maintain two separate connections when using "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"pub/sub"}]},{"type":"text","value":", where the subscriber uses a dedicated connection just listening for new messages."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In AdonisJS, we have improved the API of pub/sub and manage the subscriber connection internally for you, so that you don't have to create and manage it manually."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For demonstration, lets create a pub/sub channel for tracking user signups. Begin by creating a new preload file by executing the following ace command."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-sh","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"node ace make:prldfile redis\n\n<span class=\"token comment\"># âœ”  create    start/redis.ts</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Open the newly created file and paste the following code snippet inside it."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"start/redis.ts"}]},{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">import</span> Redis <span class=\"token keyword\">from</span> <span class=\"token string\">'@ioc:Adonis/Addons/Redis'</span>\n\nRedis<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'user:signup'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>user<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Next, create a dummy route to publish to the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"user:signup"}]},{"type":"text","value":" channel on every new HTTP request."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"start/routes.ts"}]},{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">import</span> Route <span class=\"token keyword\">from</span> <span class=\"token string\">'@ioc:Adonis/Core/Route'</span>\n<span class=\"token keyword\">import</span> Redis <span class=\"token keyword\">from</span> <span class=\"token string\">'@ioc:Adonis/Addons/Redis'</span>\n\nRoute<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/signup'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">await</span> Redis<span class=\"token punctuation\">.</span><span class=\"token function\">publish</span><span class=\"token punctuation\">(</span><span class=\"token string\">'user:signups'</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> id<span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token string\">'handled'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Redis.subscribe"}]},{"type":"text","value":" method listens for messages on a given channel."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Redis.publish"}]},{"type":"text","value":" method is used to publish events to a given channel."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The messages are passed as string, since Redis doesn't support other data types during Pub/sub."}]}]},{"type":"element","tag":"h3","props":{"id":"pattern-pubsub"},"children":[{"type":"element","tag":"a","props":{"href":"#pattern-pubsub","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Pattern pub/sub"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Redis also supports pub/sub using patterns. Instead of "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"subscribe"}]},{"type":"text","value":", you have to use the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"psubscribe"}]},{"type":"text","value":" method."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Redis<span class=\"token punctuation\">.</span><span class=\"token function\">psubscribe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'user:*'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> user<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">,</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"health-checks"},"children":[{"type":"element","tag":"a","props":{"href":"#health-checks","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Health Checks"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The Redis module uses the AdonisJS "},{"type":"element","tag":"a","props":{"href":"/guides/health-check"},"children":[{"type":"text","value":"health check"}]},{"type":"text","value":" module to report the connections health. All you need to do is enable it inside the config file."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"config/redis.ts"}]},{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token punctuation\">{</span>\n  local<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    host<span class=\"token operator\">:</span> Env<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'REDIS_HOST'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'127.0.0.1'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n    port<span class=\"token operator\">:</span> Env<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'REDIS_PORT'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'6379'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n    password<span class=\"token operator\">:</span> Env<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'REDIS_PASSWORD'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n    db<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    keyPrefix<span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n    healthCheck<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// ðŸ‘ˆ health check</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now, you can use the health check module to view the status of your redis connections."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">import</span> Route <span class=\"token keyword\">from</span> <span class=\"token string\">'@ioc:Adonis/Core/Route'</span>\n<span class=\"token keyword\">import</span> HealthCheck <span class=\"token keyword\">from</span> <span class=\"token string\">'@ioc:Adonis/Core/HealthCheck'</span>\n\nRoute<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'health'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> response <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> report <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> HealthCheck<span class=\"token punctuation\">.</span><span class=\"token function\">getReport</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> report<span class=\"token punctuation\">.</span>healthy <span class=\"token operator\">?</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span>report<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">badRequest</span><span class=\"token punctuation\">(</span>report<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"src":"https://res.cloudinary.com/adonis-js/image/upload/q_auto,w_700,f_auto,fl_lossy/v1592724884/adonisjs.com/redis-health-check.png"},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"closing-connections"},"children":[{"type":"element","tag":"a","props":{"href":"#closing-connections","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Closing connections"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can close the redis connections using one of the following methods."}]},{"type":"element","tag":"h3","props":{"id":"quit"},"children":[{"type":"element","tag":"a","props":{"href":"#quit","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"quit"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"quit"}]},{"type":"text","value":" method closes the redis connection gracefully. This method will wait for all queued commands to finish."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">await</span> Redis<span class=\"token punctuation\">.</span><span class=\"token function\">quit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">await</span> Redis<span class=\"token punctuation\">.</span><span class=\"token function\">connection</span><span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">quit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"disconnect"},"children":[{"type":"element","tag":"a","props":{"href":"#disconnect","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"disconnect"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"disconnect"}]},{"type":"text","value":" method doesn't wait for existing commands to finish and will disrupt the connection immediately."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">await</span> Redis<span class=\"token punctuation\">.</span><span class=\"token function\">disconnect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">await</span> Redis<span class=\"token punctuation\">.</span><span class=\"token function\">connection</span><span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">disconnect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"quitall"},"children":[{"type":"element","tag":"a","props":{"href":"#quitall","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"quitAll"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Similar to "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"quit"}]},{"type":"text","value":", but quits all the connections"}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">await</span> Redis<span class=\"token punctuation\">.</span><span class=\"token function\">quitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"disconnectall"},"children":[{"type":"element","tag":"a","props":{"href":"#disconnectall","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"disconnectAll"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Similar to "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"disconnect"}]},{"type":"text","value":", but disconnects all the connections."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">await</span> Redis<span class=\"token punctuation\">.</span><span class=\"token function\">disconnectAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n"}]}]}]}]}
