{"type":"root","children":[{"type":"element","tag":"dimertitle","props":{},"children":[{"type":"text","value":"Middleware"}]},{"type":"element","tag":"h1","props":{"id":"middleware"},"children":[{"type":"element","tag":"a","props":{"href":"#middleware","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Middleware"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"@adonisjs/auth"}]},{"type":"text","value":" package creates some middleware inside your application source code. The purpose of these middleware is to help you remove the repetitive code from your codebase."}]},{"type":"element","tag":"div","props":{"className":["toc-container"]},"children":[{"type":"element","tag":"h2","props":{},"children":[{"type":"text","value":"Table of contents"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#auth-middleware"},"children":[{"type":"text","value":"Auth Middleware"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#silent-auth-middleware"},"children":[{"type":"text","value":"Silent Auth Middleware"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#when-to-use-this-middleware"},"children":[{"type":"text","value":"When to use this middleware"}]}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"auth-middleware"},"children":[{"type":"element","tag":"a","props":{"href":"#auth-middleware","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Auth Middleware"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In this "},{"type":"element","tag":"a","props":{"href":"/guides/auth/web-guard#time-to-login"},"children":[{"type":"text","value":"last guide"}]},{"type":"text","value":", we made use of "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"auth.authenticate"}]},{"type":"text","value":" method within the route handler to authenticate the current request. Now imagine having dozens of routes and each time remembering to call this method."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Instead, you can make use of a middleware to protect routes from public access. In fact, during the initial setup, we create the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Auth"}]},{"type":"text","value":" middleware for you."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The middleware is stored inside "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"App/Middleware/Auth.ts"}]},{"type":"text","value":" file, just make sure to register it inside the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"start/kernel.ts"}]},{"type":"text","value":" file."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"start/kernel.ts"}]},{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Server<span class=\"token punctuation\">.</span>middleware<span class=\"token punctuation\">.</span><span class=\"token function\">registerNamed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  auth<span class=\"token operator\">:</span> <span class=\"token string\">'App/Middleware/Auth'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Once registered, you can apply on the routes."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Route\n  <span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/dashboard'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DashboardController.index'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">middleware</span><span class=\"token punctuation\">(</span><span class=\"token string\">'auth'</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The middleware will use the default guard "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"(configured inside the config file)"}]},{"type":"text","value":" to authenticate the current request. However, if your application is using more than one guards, then you can define them manually."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Route\n  <span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/dashboard'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DashboardController.index'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">middleware</span><span class=\"token punctuation\">(</span><span class=\"token string\">'auth:web, api'</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"silent-auth-middleware"},"children":[{"type":"element","tag":"a","props":{"href":"#silent-auth-middleware","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Silent Auth Middleware"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Along with auth middleware, there is an another middleware stored inside "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"App/Middleware/SilentAuth.ts"}]},{"type":"text","value":" file."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The purpose of this middleware is to silently check if the user is logged-in or not. If the user is logged-in, then you can access the user instance inside your controllers, otherwise the request will continue as usual."}]},{"type":"element","tag":"h3","props":{"id":"when-to-use-this-middleware"},"children":[{"type":"element","tag":"a","props":{"href":"#when-to-use-this-middleware","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"When to use this middleware"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Imagine, you are creating a website that has a publicly accessible homepage. In the header of the webpage, you want to display the username of the logged-in user, or display a button to login."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In this scenario, you can make use of the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"SilentAuth"}]},{"type":"text","value":" middleware to fetch the logged-in user without restricting access to public URLs."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The middleware must be registered as a global middleware to silently check every HTTP request."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"start/kernel.ts"}]},{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Server<span class=\"token punctuation\">.</span>middleware<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n  <span class=\"token string\">'App/Middleware/SilentAuth'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n"}]}]}]}]}
