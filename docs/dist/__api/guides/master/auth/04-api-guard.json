{"type":"root","children":[{"type":"element","tag":"dimertitle","props":{},"children":[{"type":"text","value":"API Guard"}]},{"type":"element","tag":"h1","props":{"id":"api-guard"},"children":[{"type":"element","tag":"a","props":{"href":"#api-guard","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"API Guard"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"api"}]},{"type":"text","value":" guard uses database backed "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"opaque tokens"}]},{"type":"text","value":" for authenticating users. In this guide, we will discuss about the different authentication strategies, along with the usage of the opaque tokens."}]},{"type":"element","tag":"div","props":{"className":["toc-container"]},"children":[{"type":"element","tag":"h2","props":{},"children":[{"type":"text","value":"Table of contents"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#authenticating-apis"},"children":[{"type":"text","value":"Authenticating APIs"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#frontend-application-on-the-same-domainsubdomain"},"children":[{"type":"text","value":"Frontend application on the same domain/subdomain"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#mobile-application"},"children":[{"type":"text","value":"Mobile application"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#frontend-app-on-a-different-domain"},"children":[{"type":"text","value":"Frontend app on a different domain"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#third-party-apps"},"children":[{"type":"text","value":"Third party apps"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#login"},"children":[{"type":"text","value":"Login"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#authentication"},"children":[{"type":"text","value":"Authentication"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#expiring-tokens"},"children":[{"type":"text","value":"Expiring tokens"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#giving-tokens-name"},"children":[{"type":"text","value":"Giving tokens name"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#where-tokens-are-saved"},"children":[{"type":"text","value":"Where tokens are saved?"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#points-to-note"},"children":[{"type":"text","value":"Points to note"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#deleting-tokens"},"children":[{"type":"text","value":"Deleting tokens"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#whats-next"},"children":[{"type":"text","value":"What's next?"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"authenticating-apis"},"children":[{"type":"element","tag":"a","props":{"href":"#authenticating-apis","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Authenticating APIs"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"The tokens based authentication is mainly targeted towards the API servers"}]},{"type":"text","value":". If you are creating a traditional, server rendered application, then we highly recommend using the "},{"type":"element","tag":"a","props":{"href":"web-guard"},"children":[{"type":"text","value":"web guard"}]},{"type":"text","value":", as it is most simplest and the secure way to authenticate users."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The authentication strategy for an API server highly depends upon its consumers."}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"h3","props":{"id":"frontend-application-on-the-same-domainsubdomain"},"children":[{"type":"element","tag":"a","props":{"href":"#frontend-application-on-the-same-domainsubdomain","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Frontend application on the same domain/subdomain"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If the consumer of your API server is only a frontend application (written in Vue, React and so on) running on the same domain/subdomain, then we recommend using the "},{"type":"element","tag":"a","props":{"href":"web-guard"},"children":[{"type":"text","value":"web guard"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The web guard uses sessions and cookies for authentication. The cookies on the same domain works great with Ajax calls and provides you the best combination of simplicity and security."}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"h3","props":{"id":"mobile-application"},"children":[{"type":"element","tag":"a","props":{"href":"#mobile-application","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Mobile application"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If the consumer of your API server is a "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"self owned mobile app"}]},{"type":"text","value":", then we recommend using "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"this guard (the api guard)"}]},{"type":"text","value":" for authentication. The tokens issued by this guard are persisted inside a database and provides you the complete control over the lifecycle of the issued tokens. For example:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If your mobile app has some security flaws, you can revoke all the tokens on the server and every user will have to login again and obtain a new token."}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"h3","props":{"id":"frontend-app-on-a-different-domain"},"children":[{"type":"element","tag":"a","props":{"href":"#frontend-app-on-a-different-domain","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Frontend app on a different domain"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If your frontend application is running on a different domain, then you can still leverage the use of cookies by creating a proxy server. This server will proxy the request of your frontend application to your API transforming the cookie into the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Authorization"}]},{"type":"text","value":" header. It should be on the same domain as your frontend application. If you cannot create a proxy, you must use "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"this guard (the api guard)"}]},{"type":"text","value":" for authentication."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The tokens issued by the server has to be persisted within the localstorage and you must read the documentation of your frontend framework to keep your applications secure from XSS attacks and also learn about "},{"type":"element","tag":"a","props":{"href":"https://content-security-policy.com/"},"children":[{"type":"text","value":"Content-Security-Policy"}]},{"type":"text","value":"."}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"h3","props":{"id":"third-party-apps"},"children":[{"type":"element","tag":"a","props":{"href":"#third-party-apps","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Third party apps"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you are creating an API server, which is consumed by third party applications, then you must look into "},{"type":"element","tag":"a","props":{"href":"https://oauth.net/2/"},"children":[{"type":"text","value":"OAuth 2.0"}]},{"type":"text","value":" and "},{"type":"element","tag":"a","props":{"href":"https://openid.net/connect/"},"children":[{"type":"text","value":"OpenID Connect"}]},{"type":"text","value":". Both of these specifications are written with years of research and answers most of the security related questions."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Unfortunately, there is no first class support for Oauth2 in AdonisJS (as of you today). However, you can use other packages from npm to implement an Oauth2 server."}]},{"type":"element","tag":"h2","props":{"id":"login"},"children":[{"type":"element","tag":"a","props":{"href":"#login","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Login"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Once, the "},{"type":"element","tag":"a","props":{"href":"setup"},"children":[{"type":"text","value":"setup"}]},{"type":"text","value":" has been completed, you can use the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"api"}]},{"type":"text","value":" guard to generate the "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"oat tokens"}]},{"type":"text","value":" for a given user."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Open "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"start/routes.ts"}]},{"type":"text","value":" file and paste the following route declaration inside it."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"start/routes.ts"}]},{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Route<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/login'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'AuthController.login'</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Next, create the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"AuthController.ts"}]},{"type":"text","value":" file and paste the following contents inside it."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"app/Controllers/Http/AuthController.ts"}]},{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> HttpContextContract <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@ioc:Adonis/Core/HttpContext'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AuthController</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">async</span> <span class=\"token function\">login</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> request<span class=\"token punctuation\">,</span> auth <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> HttpContextContract<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> email <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">input</span><span class=\"token punctuation\">(</span><span class=\"token string\">'email'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> password <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">input</span><span class=\"token punctuation\">(</span><span class=\"token string\">'password'</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">const</span> token <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> auth<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">'api'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">attempt</span><span class=\"token punctuation\">(</span>email<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> token<span class=\"token punctuation\">.</span><span class=\"token function\">toJSON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now, start the development server "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"node ace serve --watch"}]},{"type":"text","value":" and make a POST request to "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"/login"}]},{"type":"text","value":" route to receive the api token."}]},{"type":"element","tag":"div","props":{"className":["embed","video"]},"children":[{"type":"element","tag":"video","props":{"controls":true},"children":[{"type":"element","tag":"source","props":{"src":"https://res.cloudinary.com/adonis-js/video/upload/q_80/v1592800689/adonisjs.com/oat-auth-login_qt8adc.mp4","type":"video/mp4"},"children":[]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"auth.use('api')"}]},{"type":"text","value":" method selects the API guard."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":".attempt"}]},{"type":"text","value":" method accepts the user login id and the password. After verifying the credentials, it will issue the api token."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The token is an instance of "},{"type":"element","tag":"a","props":{"href":"https://github.com/adonisjs/auth/blob/develop/src/Tokens/OpaqueToken/index.ts"},"children":[{"type":"text","value":"OpaqueToken"}]},{"type":"text","value":" class and calling "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":".toJSON"}]},{"type":"text","value":" returns an object to be shared in the response."}]}]},{"type":"element","tag":"h2","props":{"id":"authentication"},"children":[{"type":"element","tag":"a","props":{"href":"#authentication","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Authentication"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Once, the token has been issued, the client can use it to authenticate themselves. The token must be passed inside the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Authorization"}]},{"type":"text","value":" header. For example:"}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-markup","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Authorization: Bearer token-value-goes-here\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For demonstration, lets create a new route and protect it from public access. Open the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"start/routes.ts"}]},{"type":"text","value":" file and add the following route inside it."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Route<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dashboard'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> auth <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">await</span> auth<span class=\"token punctuation\">.</span><span class=\"token function\">authenticate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//  👈 All you need to go</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    hello<span class=\"token operator\">:</span> <span class=\"token string\">'world'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now, lets the visit the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"dashboard"}]},{"type":"text","value":" route without and with the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Authorization"}]},{"type":"text","value":" header."}]},{"type":"element","tag":"div","props":{"className":["embed","video"]},"children":[{"type":"element","tag":"video","props":{"controls":true},"children":[{"type":"element","tag":"source","props":{"src":"https://res.cloudinary.com/adonis-js/video/upload/q_80/v1592803305/adonisjs.com/oat-authenticate_wlmyri.mp4","type":"video/mp4"},"children":[]}]}]},{"type":"element","tag":"h2","props":{"id":"expiring-tokens"},"children":[{"type":"element","tag":"a","props":{"href":"#expiring-tokens","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Expiring tokens"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By default, the tokens have life long validity (until deleted). However, you can define expiry for the tokens at the time of the creating one."}]},{"type":"element","tag":"div","props":{"className":["alert","alert-note"]},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Expired tokens are not deleted from the database automatically. You may have to run write a custom script to do that. However, we have plans to add that script to the package itself."}]}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">await</span> auth<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">'api'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">attempt</span><span class=\"token punctuation\">(</span>uid<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  expiresIn<span class=\"token operator\">:</span> <span class=\"token string\">'10 days'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// login using user instance</span>\n<span class=\"token keyword\">await</span> auth<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">'api'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">login</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  expiresIn<span class=\"token operator\">:</span> <span class=\"token string\">'10 days'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// login via id</span>\n<span class=\"token keyword\">await</span> auth<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">'api'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">loginViaId</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  expiresIn<span class=\"token operator\">:</span> <span class=\"token string\">'10 days'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"giving-tokens-name"},"children":[{"type":"element","tag":"a","props":{"href":"#giving-tokens-name","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Giving tokens name"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Based upon your usage of the tokens, you may want to give descriptive names to the generated tokens. For example: If you let the users of your application generate tokens from a dashboard (similar to Github), then it may make sense to let them give names to these tokens as well."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">const</span> token <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> auth<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">'api'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">generate</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  name<span class=\"token operator\">:</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">input</span><span class=\"token punctuation\">(</span><span class=\"token string\">'token_name'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"where-tokens-are-saved"},"children":[{"type":"element","tag":"a","props":{"href":"#where-tokens-are-saved","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Where tokens are saved?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The storage of tokens is decided by the driver in use. Currently, we only have "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"database"}]},{"type":"text","value":" driver that stores the tokens inside a SQL table called "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"api_tokens"}]},{"type":"text","value":". You can inspect the config by opening "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"config/auth.ts"}]},{"type":"text","value":" file."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token punctuation\">{</span>\n  tokenProvider<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    driver<span class=\"token operator\">:</span> <span class=\"token string\">'database'</span><span class=\"token punctuation\">,</span>\n    table<span class=\"token operator\">:</span> <span class=\"token string\">'api_tokens'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The default database connection (defined inside "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"config/database.ts"}]},{"type":"text","value":") file is used. If you want to use a different connection, you can specify it inside the config."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token punctuation\">{</span>\n  tokenProvider<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    driver<span class=\"token operator\">:</span> <span class=\"token string\">'database'</span><span class=\"token punctuation\">,</span>\n    table<span class=\"token operator\">:</span> <span class=\"token string\">'api_tokens'</span><span class=\"token punctuation\">,</span>\n    connection<span class=\"token operator\">:</span> <span class=\"token string\">'a-different-connection'</span> <span class=\"token comment\">// 👈</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>  \n<span class=\"token punctuation\">}</span>\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"points-to-note"},"children":[{"type":"element","tag":"a","props":{"href":"#points-to-note","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Points to note"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The tokens saved inside the database are hashed using "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"sha-256"}]},{"type":"text","value":" algorithm."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"You can access the original token value only at the time of generating a new token. After that, there is no way to retrieve the plain token. "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"This is how tokens should work"}]},{"type":"text","value":"."}]}]},{"type":"element","tag":"h2","props":{"id":"deleting-tokens"},"children":[{"type":"element","tag":"a","props":{"href":"#deleting-tokens","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Deleting tokens"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can delete a token using the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"auth.logout"}]},{"type":"text","value":" method or manually run a delete query. Once the token is deleted, it cannot be used for authentication."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">await</span> auth<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">'api'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">logout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Using the database query builder"}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">import</span> Database <span class=\"token keyword\">from</span> <span class=\"token string\">'@ioc:Adonis/Lucid/Database'</span>\n\n<span class=\"token keyword\">await</span> Database<span class=\"token punctuation\">.</span><span class=\"token keyword\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">'api_tokens'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span> tokenId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">delete</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"whats-next"},"children":[{"type":"element","tag":"a","props":{"href":"#whats-next","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"What's next?"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"middleware"},"children":[{"type":"text","value":"Using middleware"}]},{"type":"text","value":" to protect routes from unauthenticated users."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"handling-exceptions"},"children":[{"type":"text","value":"Understanding the flow"}]},{"type":"text","value":" of exceptions raised by the auth module."}]}]}]}
