{"type":"root","children":[{"type":"element","tag":"dimertitle","props":{},"children":[{"type":"text","value":"Setup"}]},{"type":"element","tag":"h1","props":{"id":"setup"},"children":[{"type":"element","tag":"a","props":{"href":"#setup","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Setup"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In this guide, you will install "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"@adonisjs/auth"}]},{"type":"text","value":" package and configure it with the desired provider and the guard."}]},{"type":"element","tag":"div","props":{"className":["toc-container"]},"children":[{"type":"element","tag":"h2","props":{},"children":[{"type":"text","value":"Table of contents"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#run-migrations"},"children":[{"type":"text","value":"Run migrations"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#contracts-overview"},"children":[{"type":"text","value":"Contracts overview"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#config-overview"},"children":[{"type":"text","value":"Config overview"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#guard"},"children":[{"type":"text","value":"guard"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#list"},"children":[{"type":"text","value":"list"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#providermodel"},"children":[{"type":"text","value":"provider.model"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#provideruids"},"children":[{"type":"text","value":"provider.uids"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#providersuserstable"},"children":[{"type":"text","value":"providers.usersTable"}]}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Let's begin by installing the package from the npm registry."}]},{"type":"element","tag":"div","props":{"className":["alert","alert-note"]},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The auth provider relies on the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"@adonisjs/lucid"}]},{"type":"text","value":" package. So make sure that it is "},{"type":"element","tag":"a","props":{"href":"/guides/database/setup"},"children":[{"type":"text","value":"configured properly"}]},{"type":"text","value":" before installing the auth package."}]}]},{"type":"element","tag":"div","props":{"className":["tabs"]},"children":[{"type":"element","tag":"div","props":{"className":["tab-head"]},"children":[{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{"dataTitle":"tab-1"},"children":[{"type":"text","value":"npm"}]},{"type":"element","tag":"li","props":{"dataTitle":"tab-2"},"children":[{"type":"text","value":"yarn"}]}]}]},{"type":"element","tag":"div","props":{"className":["tab-body"]},"children":[{"type":"element","tag":"div","props":{"className":["tab-item"],"id":"tab-1"},"children":[{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"npm"}]},{"type":"element","tag":"pre","props":{"className":["language-sh","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token function\">npm</span> i @adonisjs/auth@alpha\n"}]}]}]}]},{"type":"element","tag":"div","props":{"className":["tab-item"],"id":"tab-2"},"children":[{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"yarn"}]},{"type":"element","tag":"pre","props":{"className":["language-sh","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token function\">yarn</span> <span class=\"token function\">add</span> @adonisjs/auth@alpha\n"}]}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Next, run the following ace command to setup the package."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-sh","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"node ace invoke @adonisjs/auth\n"}]}]}]},{"type":"element","tag":"div","props":{"className":["embed","video"]},"children":[{"type":"element","tag":"video","props":{"controls":true},"children":[{"type":"element","tag":"source","props":{"src":"https://res.cloudinary.com/adonis-js/video/upload/q_80/v1592764868/adonisjs.com/auth-api-setup_amvpvi.mp4","type":"video/mp4"},"children":[]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The setup command prompts you to select the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"provider"}]},{"type":"text","value":" and the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"guard"}]},{"type":"text","value":" and generates the config file based on your selection"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"When using Lucid, you are also prompted to create the model."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Finally, you can optionally create the migrations to setup the database tables."}]}]},{"type":"element","tag":"h2","props":{"id":"run-migrations"},"children":[{"type":"element","tag":"a","props":{"href":"#run-migrations","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Run migrations"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"ace invoke"}]},{"type":"text","value":" command creates a migration file with the following contents to create the database table."}]},{"type":"element","tag":"div","props":{"className":["alert","alert-note"]},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Feel free to make any modifications to the migration file. Just make sure that "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"password"}]},{"type":"text","value":" and the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"remember_me_token"}]},{"type":"text","value":" fields are present."}]}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">import</span> BaseSchema <span class=\"token keyword\">from</span> <span class=\"token string\">'@ioc:Adonis/Lucid/Schema'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Users</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseSchema</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">protected</span> tableName <span class=\"token operator\">=</span> <span class=\"token string\">'users'</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">async</span> <span class=\"token function\">up</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>schema<span class=\"token punctuation\">.</span><span class=\"token function\">createTable</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>tableName<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      table<span class=\"token punctuation\">.</span><span class=\"token function\">increments</span><span class=\"token punctuation\">(</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">primary</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      table<span class=\"token punctuation\">.</span><span class=\"token function\">string</span><span class=\"token punctuation\">(</span><span class=\"token string\">'email'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">notNullable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      table<span class=\"token punctuation\">.</span><span class=\"token function\">string</span><span class=\"token punctuation\">(</span><span class=\"token string\">'password'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">180</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">notNullable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      table<span class=\"token punctuation\">.</span><span class=\"token function\">string</span><span class=\"token punctuation\">(</span><span class=\"token string\">'remember_me_token'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">nullable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      table<span class=\"token punctuation\">.</span><span class=\"token function\">timestamps</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">async</span> <span class=\"token function\">down</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>schema<span class=\"token punctuation\">.</span><span class=\"token function\">dropTable</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>tableName<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Execute the following command to run the pending migrations."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-sh","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"node ace migration:run\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"contracts-overview"},"children":[{"type":"element","tag":"a","props":{"href":"#contracts-overview","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Contracts overview"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"During the setup process, we create a "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"contracts/auth.ts"}]},{"type":"text","value":" file. This file contains the "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"static definition"}]},{"type":"text","value":" of providers and guards you want to use inside your application."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"contracts/auth.ts"}]},{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">import</span> User <span class=\"token keyword\">from</span> <span class=\"token string\">'App/Models/User'</span>\n\n<span class=\"token keyword\">declare</span> <span class=\"token keyword\">module</span> <span class=\"token string\">'@ioc:Adonis/Addons/Auth'</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">interface</span> <span class=\"token class-name\">ProvidersList</span> <span class=\"token punctuation\">{</span>\n    user<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      implementation<span class=\"token operator\">:</span> LucidProviderContract<span class=\"token operator\">&lt;</span><span class=\"token keyword\">typeof</span> User<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n      config<span class=\"token operator\">:</span> LucidProviderConfig<span class=\"token operator\">&lt;</span><span class=\"token keyword\">typeof</span> User<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">interface</span> <span class=\"token class-name\">GuardsList</span> <span class=\"token punctuation\">{</span>\n    web<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      implementation<span class=\"token operator\">:</span> SessionGuardContract<span class=\"token operator\">&lt;</span><span class=\"token string\">'user'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'web'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n      config<span class=\"token operator\">:</span> SessionGuardConfig<span class=\"token operator\">&lt;</span><span class=\"token string\">'user'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The contract file puts static validation on your configuration file and the runtime code."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For example: If you decide to use a different model (other than the User model), then first change it inside the contract file and then the typescript compiler will also force you to update the config file as well."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In other words, think of this file as a single source of truth for inferring static types and intellisense throughout your application."}]},{"type":"element","tag":"h2","props":{"id":"config-overview"},"children":[{"type":"element","tag":"a","props":{"href":"#config-overview","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Config overview"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The configuration for the auth module is stored inside "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"config/auth.ts"}]},{"type":"text","value":" file. Lets go through some of the important configuration options for a better understand of the authentication flow."}]},{"type":"element","tag":"h3","props":{"id":"guard"},"children":[{"type":"element","tag":"a","props":{"href":"#guard","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"guard"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"guard"}]},{"type":"text","value":" property defines the default guard you want to use for authentication. Having a default guard removes the need of first selecting the guard and then performing actions on it. For example:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Instead of writing"}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"auth<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">'web'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">login</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can write the following code and the auth module will automatically use the default guard to execute the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"login"}]},{"type":"text","value":" action."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"auth<span class=\"token punctuation\">.</span><span class=\"token function\">login</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"list"},"children":[{"type":"element","tag":"a","props":{"href":"#list","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"list"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"list"}]},{"type":"text","value":" property holds a collection of one or more guards you want to use. Majority of applications will only need a single guard. However, there can be situations, when you want support multiple style of login. For example:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Using the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"web"}]},{"type":"text","value":" guard to login and authenticate users on your web application."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"And using the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"api"}]},{"type":"text","value":" guard for mobile app authentication."}]}]},{"type":"element","tag":"h3","props":{"id":"providermodel"},"children":[{"type":"element","tag":"a","props":{"href":"#providermodel","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"provider.model"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"model"}]},{"type":"text","value":" property is used by the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"lucid"}]},{"type":"text","value":" provider. You can make use of any Lucid model here, just make sure that the model has "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"password"}]},{"type":"text","value":" and "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"rememberMeToken"}]},{"type":"text","value":" properties on it."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"During the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"login"}]},{"type":"text","value":", or the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"authenticate"}]},{"type":"text","value":" calls, we will use this model to look up a user."}]},{"type":"element","tag":"h3","props":{"id":"provideruids"},"children":[{"type":"element","tag":"a","props":{"href":"#provideruids","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"provider.uids"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"uids"}]},{"type":"text","value":" property allows the user of your website to login using multiple identifiers. For example: If you want your users to login with both the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"email"}]},{"type":"text","value":" and the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"username"}]},{"type":"text","value":", then you can add to the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"uids"}]},{"type":"text","value":" arrays."}]},{"type":"element","tag":"h3","props":{"id":"providersuserstable"},"children":[{"type":"element","tag":"a","props":{"href":"#providersuserstable","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"providers.usersTable"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"database"}]},{"type":"text","value":" provider needs the name of the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"table"}]},{"type":"text","value":" to lookup users. Just make sure that the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"usersTable"}]},{"type":"text","value":" has "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"password"}]},{"type":"text","value":" and "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"remember_me_token"}]},{"type":"text","value":" columns."}]}]}
