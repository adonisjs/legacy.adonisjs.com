{"type":"root","children":[{"type":"element","tag":"dimertitle","props":{},"children":[{"type":"text","value":"Many to Many"}]},{"type":"element","tag":"h1","props":{"id":"many-to-many"},"children":[{"type":"element","tag":"a","props":{"href":"#many-to-many","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Many to Many"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"ManyToMany"}]},{"type":"text","value":" relationship allows an entity have a relationship with multiple other entities. For example: A "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"user has many skills"}]},{"type":"text","value":", and the same time "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"a skill can also belongs to many different users"}]},{"type":"text","value":"."}]},{"type":"element","tag":"div","props":{"className":["toc-container"]},"children":[{"type":"element","tag":"h2","props":{},"children":[{"type":"text","value":"Table of contents"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#when-to-use-a-many-to-many-relationship"},"children":[{"type":"text","value":"When to use a many to many relationship?"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#relationship-models"},"children":[{"type":"text","value":"Relationship models"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#relationship-keys"},"children":[{"type":"text","value":"Relationship keys"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#localkey"},"children":[{"type":"text","value":"localKey"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#relatedkey"},"children":[{"type":"text","value":"relatedKey"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#pivotforeignkey"},"children":[{"type":"text","value":"pivotForeignKey"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#pivotrelatedforeignkey"},"children":[{"type":"text","value":"pivotRelatedForeignKey"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#custom-pivot-table"},"children":[{"type":"text","value":"Custom pivot table"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#preloading-relationship"},"children":[{"type":"text","value":"Preloading relationship"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#many-to-many-query-builder"},"children":[{"type":"text","value":"Many to many query builder"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#pivotcolumns"},"children":[{"type":"text","value":"pivotColumns"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#wherepivot"},"children":[{"type":"text","value":"wherePivot"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#persisting-relationship"},"children":[{"type":"text","value":"Persisting relationship"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#savesavemany"},"children":[{"type":"text","value":"save/saveMany"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#createcreatemany"},"children":[{"type":"text","value":"create/createMany"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#attach"},"children":[{"type":"text","value":"attach"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#detach"},"children":[{"type":"text","value":"detach"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#sync"},"children":[{"type":"text","value":"sync"}]}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When working with a many to many relationship, you will always need a 3rd table (commonly known as a pivot table) to represent the relationship."}]},{"type":"element","tag":"h2","props":{"id":"when-to-use-a-many-to-many-relationship"},"children":[{"type":"element","tag":"a","props":{"href":"#when-to-use-a-many-to-many-relationship","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"When to use a many to many relationship?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Let's imagine, you have a "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"users"}]},{"type":"text","value":" table and a "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"skills"}]},{"type":"text","value":" table and you decided to put the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"user_id"}]},{"type":"text","value":" inside the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"skills"}]},{"type":"text","value":" table."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"skills"}]},{"type":"element","tag":"pre","props":{"className":["language-markup","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"+----------------------+\n| skills               |\n+------------+---------+\n| id         | int     |\n+------------+---------+\n| user_id    | int     |\n+------------+---------+\n| name       | varchar |\n+------------+---------+\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"With the above table, you will have to create a new skill for every user. Also, the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"skills"}]},{"type":"text","value":" table will have many duplicate skills one for each user. To solve this problem:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"You should remove the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"user_id"}]},{"type":"text","value":" from the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"skills"}]},{"type":"text","value":" table and keep it as an independent database table."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"By making the table independent, you can pre-fill the skills table and also use it to create a dropdown for selecting skills."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Create a new pivot table called the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"skill_user"}]},{"type":"text","value":". This table will hold the ids to create a relationship between a user and a skill."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You will end up with something similar to the following table structure."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"src":"https://res.cloudinary.com/adonis-js/image/upload/q_auto,w_700,f_auto,fl_lossy/v1588083600/adonisjs.com/many-to-many.png"},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"relationship-models"},"children":[{"type":"element","tag":"a","props":{"href":"#relationship-models","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Relationship models"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Just like the other relationships, you will have to create just two models. The pivot table doesn't need a different model."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Following is an example of the User model."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"app/Models/User.ts"}]},{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> column<span class=\"token punctuation\">,</span> BaseModel<span class=\"token punctuation\">,</span> manyToMany<span class=\"token punctuation\">,</span> ManyToMany <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@ioc:Adonis/Lucid/Orm'</span>\n<span class=\"token keyword\">import</span> Skill <span class=\"token keyword\">from</span> <span class=\"token string\">'App/Models/Skill'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseModel</span> <span class=\"token punctuation\">{</span>\n<span class=\"dimer-highlight-code-line\">  @<span class=\"token function\">manyToMany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Skill<span class=\"token punctuation\">)</span></span><span class=\"dimer-highlight-code-line\">  <span class=\"token keyword\">public</span> skills<span class=\"token operator\">:</span> ManyToMany<span class=\"token operator\">&lt;</span><span class=\"token keyword\">typeof</span> Skill<span class=\"token operator\">></span></span><span class=\"token punctuation\">}</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The Skill model will have a set of standard properties, since there isn't any foreign key in the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"skills"}]},{"type":"text","value":" table."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"app/Models/Skill.ts"}]},{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> column<span class=\"token punctuation\">,</span> BaseModel <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@ioc:Adonis/Lucid/Orm'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Skill</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseModel</span> <span class=\"token punctuation\">{</span>\n  @<span class=\"token function\">column</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> isPrimary<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">public</span> id<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span>\n\n  @<span class=\"token function\">column</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">public</span> name<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n<span class=\"token punctuation\">}</span>\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"relationship-keys"},"children":[{"type":"element","tag":"a","props":{"href":"#relationship-keys","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Relationship keys"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A many to many relation relies on many different keys to properly setup the relationship. All of these are keys are computed using standard conventions. However, you are free to override them."}]},{"type":"element","tag":"h3","props":{"id":"localkey"},"children":[{"type":"element","tag":"a","props":{"href":"#localkey","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"localKey"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The local key is mostly the primary key of the "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"parent model"}]},{"type":"text","value":". In our example: User is the parent model and "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"localKey"}]},{"type":"text","value":" will be the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"id"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"relatedkey"},"children":[{"type":"element","tag":"a","props":{"href":"#relatedkey","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"relatedKey"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The related key is mostly the primary key of the "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"related model"}]},{"type":"text","value":". In our example: Skill is the related model and "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"relatedKey"}]},{"type":"text","value":" will also be the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"id"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"pivotforeignkey"},"children":[{"type":"element","tag":"a","props":{"href":"#pivotforeignkey","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"pivotForeignKey"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The foreign key is in the pivot table to create the relationship with the "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"parent model"}]},{"type":"text","value":". Conventionally, it is "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"snake_case"}]},{"type":"text","value":" representation of the model name and its primary key. In our example: The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"pivotForeignKey"}]},{"type":"text","value":" will be "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"user_id"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"pivotrelatedforeignkey"},"children":[{"type":"element","tag":"a","props":{"href":"#pivotrelatedforeignkey","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"pivotRelatedForeignKey"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The related foreign key is in the pivot table to create the relationship with the "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"related model"}]},{"type":"text","value":". Conventionally, it is "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"snake_case"}]},{"type":"text","value":" representation of the model name and its primary key. In our example: The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"pivotRelatedForeignKey"}]},{"type":"text","value":" will be "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"skill_id"}]},{"type":"text","value":"."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"@<span class=\"token function\">manyToMany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Skill<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  localKey<span class=\"token operator\">:</span> <span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span>\n  pivotForeignKey<span class=\"token operator\">:</span> <span class=\"token string\">'user_id'</span><span class=\"token punctuation\">,</span>\n  relatedKey<span class=\"token operator\">:</span> <span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span>\n  pivotRelatedForeignKey<span class=\"token operator\">:</span> <span class=\"token string\">'skill_id'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> skills<span class=\"token operator\">:</span> ManyToMany<span class=\"token operator\">&lt;</span><span class=\"token keyword\">typeof</span> Skill<span class=\"token operator\">></span>\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"custom-pivot-table"},"children":[{"type":"element","tag":"a","props":{"href":"#custom-pivot-table","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Custom pivot table"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By default, the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"pivotTable"}]},{"type":"text","value":" name is the snake case representation of the "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"parent model name"}]},{"type":"text","value":" and the "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"related model name"}]},{"type":"text","value":". Also, the model names are sorted before joining them together."}]},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"Parent Model Name"}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"Related Model Name"}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"Sorted Combination"}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"Pivot Table"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"User"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"Skill"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"Skill_User"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"skill_user"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"However, you can also define a custom pivot table."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"@<span class=\"token function\">manyToMany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Skill<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  pivotTable<span class=\"token operator\">:</span> <span class=\"token string\">'user_skills'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> skills<span class=\"token operator\">:</span> ManyToMany<span class=\"token operator\">&lt;</span><span class=\"token keyword\">typeof</span> Skill<span class=\"token operator\">></span>\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"preloading-relationship"},"children":[{"type":"element","tag":"a","props":{"href":"#preloading-relationship","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Preloading relationship"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The preloading API for a many to many relationship is similar to the "},{"type":"element","tag":"a","props":{"href":"/guides/model-relations/introduction#preloading-relationship"},"children":[{"type":"text","value":"other relationships"}]},{"type":"text","value":". However, the values of the pivot table are prefixed and moved to the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"$extras"}]},{"type":"text","value":" object on the model instance. For example:"}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> User<span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">preload</span><span class=\"token punctuation\">(</span><span class=\"token string\">'skills'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">first</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nuser<span class=\"token punctuation\">.</span>skills<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>skill<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>skill<span class=\"token punctuation\">.</span>$extras<span class=\"token punctuation\">.</span>pivot_user_id<span class=\"token punctuation\">)</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>skill<span class=\"token punctuation\">.</span>$extras<span class=\"token punctuation\">.</span>pivot_skill_id<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The columns names of the pivot table are prefixed with "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"pivot_"}]},{"type":"text","value":". This is done to avoid any conflicts and convey a clear purpose."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Also, the values are not defined on the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"skill"}]},{"type":"text","value":" model instance, but on the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"$extras"}]},{"type":"text","value":" object."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Skill model has no pre-defined properties like "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"pivot_user_id"}]},{"type":"text","value":". So, the typescript compiler will never allow you to read this property, unless it is defined."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"When serializing the model to JSON, the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"$extras"}]},{"type":"text","value":" object is ignored and it means you are not leaking these properties in your API."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If for some reason, you want to serialize some properties of the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"$extras"}]},{"type":"text","value":" object, you can create a computed property on your "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"skill"}]},{"type":"text","value":" model and then expose it."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">class</span> <span class=\"token class-name\">Skill</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseModel</span> <span class=\"token punctuation\">{</span>\n  @<span class=\"token function\">computed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">get</span> <span class=\"token function\">proficiency</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$extras<span class=\"token punctuation\">.</span>pivot_proficiency\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n"}]}]}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"many-to-many-query-builder"},"children":[{"type":"element","tag":"a","props":{"href":"#many-to-many-query-builder","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Many to many query builder"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The query builder for the many to many relationship has a few extra methods over the standard query builder."}]},{"type":"element","tag":"h3","props":{"id":"pivotcolumns"},"children":[{"type":"element","tag":"a","props":{"href":"#pivotcolumns","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"pivotColumns"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By default, only the foreign keys are selected from the pivot table. However, you can also select extra columns. For example:"}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"],"dataLine":"4"},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> User\n  <span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">preload</span><span class=\"token punctuation\">(</span><span class=\"token string\">'skills'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"dimer-highlight-code-line\">    query<span class=\"token punctuation\">.</span><span class=\"token function\">pivotColumns</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'proficiency'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">first</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nuser<span class=\"token punctuation\">.</span>skills<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>skill<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>skill<span class=\"token punctuation\">.</span>$extras<span class=\"token punctuation\">.</span>pivot_proficiency<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can also specify "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"pivotColumns"}]},{"type":"text","value":" on the relationship definition as well. As per the following example, the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"proficiency"}]},{"type":"text","value":" key will always be selected."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"@<span class=\"token function\">manyToMany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Skill<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  pivotColumns<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'proficiency'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> skills<span class=\"token operator\">:</span> ManyToMany<span class=\"token operator\">&lt;</span><span class=\"token keyword\">typeof</span> Skill<span class=\"token operator\">></span>\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"wherepivot"},"children":[{"type":"element","tag":"a","props":{"href":"#wherepivot","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"wherePivot"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"wherePivot"}]},{"type":"text","value":" method allows adding constraints on the pivot table."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> User\n  <span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">preload</span><span class=\"token punctuation\">(</span><span class=\"token string\">'skills'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    query<span class=\"token punctuation\">.</span><span class=\"token function\">wherePivot</span><span class=\"token punctuation\">(</span><span class=\"token string\">'proficiency'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'expert'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">first</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The following variations are available."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"whereNotPivot"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"whereInPivot"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"whereNotInPivot"}]}]}]},{"type":"element","tag":"h2","props":{"id":"persisting-relationship"},"children":[{"type":"element","tag":"a","props":{"href":"#persisting-relationship","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Persisting relationship"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The standard persistance methods will make sure to setup the relationship inside the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"pivotTable"}]},{"type":"text","value":". By default, the duplicate entries will be ignored, however, you can disable that behavior."}]},{"type":"element","tag":"h3","props":{"id":"savesavemany"},"children":[{"type":"element","tag":"a","props":{"href":"#savesavemany","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"save/saveMany"}]}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> User<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> skill <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Skill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nskill<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'Programming'</span>\n\n<span class=\"token keyword\">await</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">related</span><span class=\"token punctuation\">(</span><span class=\"token string\">'skills'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>skill<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// or saveMany</span>\n<span class=\"token keyword\">await</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">related</span><span class=\"token punctuation\">(</span><span class=\"token string\">'skills'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">saveMany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>skill<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Pass "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"false (boolean)"}]},{"type":"text","value":" as the second argument to create duplicate entries inside the pivot table."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">await</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">related</span><span class=\"token punctuation\">(</span><span class=\"token string\">'skills'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>skill<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"createcreatemany"},"children":[{"type":"element","tag":"a","props":{"href":"#createcreatemany","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"create/createMany"}]}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> User<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> skill <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Skill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nskill<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'Programming'</span>\n\n<span class=\"token keyword\">await</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">related</span><span class=\"token punctuation\">(</span><span class=\"token string\">'skills'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  name<span class=\"token operator\">:</span> <span class=\"token string\">'Programming'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// or createMany</span>\n<span class=\"token keyword\">await</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">related</span><span class=\"token punctuation\">(</span><span class=\"token string\">'skills'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">createMany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    name<span class=\"token operator\">:</span> <span class=\"token string\">'Programming'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    name<span class=\"token operator\">:</span> <span class=\"token string\">'Cooking'</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Pass "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"false (boolean)"}]},{"type":"text","value":" as the second argument to create duplicate entries inside the pivot table."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">await</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">related</span><span class=\"token punctuation\">(</span><span class=\"token string\">'skills'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  name<span class=\"token operator\">:</span> <span class=\"token string\">'Programming'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"attach"},"children":[{"type":"element","tag":"a","props":{"href":"#attach","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"attach"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"attach"}]},{"type":"text","value":" method allows you to setup relationships inside the pivot table by just using the ids. For example:"}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> User<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> skill <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> Skill<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">await</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">related</span><span class=\"token punctuation\">(</span><span class=\"token string\">'skills'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">attach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>skill<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can also pass custom pivot table attributes to the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"attach"}]},{"type":"text","value":" method."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">await</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">related</span><span class=\"token punctuation\">(</span><span class=\"token string\">'skills'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">attach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">[</span>skill<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    proficiency<span class=\"token operator\">:</span> <span class=\"token string\">'master'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"detach"},"children":[{"type":"element","tag":"a","props":{"href":"#detach","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"detach"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"detach"}]},{"type":"text","value":" method is the opposite of the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"attach"}]},{"type":"text","value":" method. You can remove relationships for the selected ids or remove all relationships."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> User<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> skill <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> Skill<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">await</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">related</span><span class=\"token punctuation\">(</span><span class=\"token string\">'skills'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">detach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>skill<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// or detach all skills</span>\n<span class=\"token keyword\">await</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">related</span><span class=\"token punctuation\">(</span><span class=\"token string\">'skills'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">detach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"sync"},"children":[{"type":"element","tag":"a","props":{"href":"#sync","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"sync"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"sync"}]},{"type":"text","value":" method is a combination of "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"detach"}]},{"type":"text","value":" and "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"attach"}]},{"type":"text","value":", but a little bit smarter. Instead of removing all the relationship and then re-defining them, it will perform sync by computing a diff."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Following is an example of performing "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"detach"}]},{"type":"text","value":" and then "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"attach"}]},{"type":"text","value":"."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> User<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> userSelectedSkills <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\">// remove all</span>\n<span class=\"token keyword\">await</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">related</span><span class=\"token punctuation\">(</span><span class=\"token string\">'skills'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">detach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// attach fresh</span>\n<span class=\"token keyword\">await</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">related</span><span class=\"token punctuation\">(</span><span class=\"token string\">'skills'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">attach</span><span class=\"token punctuation\">(</span>userSelectedSkills<span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In the above example, even when the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"userSelectedSkills"}]},{"type":"text","value":" are same, you will unnecessary remove all the rows and then re-insert them. This also make the auto-increment counter jump for no reasons."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Whereas the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"diff"}]},{"type":"text","value":" approach performs only the required set of operations."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> User<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> userSelectedSkills <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">await</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">related</span><span class=\"token punctuation\">(</span><span class=\"token string\">'skills'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sync</span><span class=\"token punctuation\">(</span>userSelectedSkills<span class=\"token punctuation\">)</span>\n"}]}]}]}]}
