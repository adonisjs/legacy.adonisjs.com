{"type":"root","children":[{"type":"element","tag":"dimertitle","props":{},"children":[{"type":"text","value":"Has Many"}]},{"type":"element","tag":"h1","props":{"id":"has-many"},"children":[{"type":"element","tag":"a","props":{"href":"#has-many","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Has Many"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"HasMany"}]},{"type":"text","value":" relationship creates a "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"one-to-many"}]},{"type":"text","value":" relationship between two models. A great example of this is "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"a user has many posts"}]},{"type":"text","value":"."}]},{"type":"element","tag":"div","props":{"className":["toc-container"]},"children":[{"type":"element","tag":"h2","props":{},"children":[{"type":"text","value":"Table of contents"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#relationship-models"},"children":[{"type":"text","value":"Relationship models"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#custom-foreign-key"},"children":[{"type":"text","value":"Custom foreign key"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#custom-local-key"},"children":[{"type":"text","value":"Custom local key"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#table-structure"},"children":[{"type":"text","value":"Table structure"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#preloading-relationship"},"children":[{"type":"text","value":"Preloading relationship"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#persisting-relationship"},"children":[{"type":"text","value":"Persisting relationship"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#createmany"},"children":[{"type":"text","value":"createMany"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#savemany"},"children":[{"type":"text","value":"saveMany"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#updateorcreatemany"},"children":[{"type":"text","value":"updateOrCreateMany"}]}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"relationship-models"},"children":[{"type":"element","tag":"a","props":{"href":"#relationship-models","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Relationship models"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Continuing with the user and the posts example. Following is the User model with "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"hasMany"}]},{"type":"text","value":" relationship."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"app/Models/User.ts"}]},{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> column<span class=\"token punctuation\">,</span> BaseModel<span class=\"token punctuation\">,</span> hasMany<span class=\"token punctuation\">,</span> HasMany <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@ioc:Adonis/Lucid/Orm'</span>\n<span class=\"token keyword\">import</span> Post <span class=\"token keyword\">from</span> <span class=\"token string\">'App/Models/Post'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseModel</span> <span class=\"token punctuation\">{</span>\n<span class=\"dimer-highlight-code-line\">  @<span class=\"token function\">hasMany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Post<span class=\"token punctuation\">)</span></span><span class=\"dimer-highlight-code-line\">  <span class=\"token keyword\">public</span> posts<span class=\"token operator\">:</span> HasMany<span class=\"token operator\">&lt;</span><span class=\"token keyword\">typeof</span> Post<span class=\"token operator\">></span></span><span class=\"token punctuation\">}</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The Post model must have a foreign key column "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"userId"}]},{"type":"text","value":" defined on it."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"app/Models/Post.ts"}]},{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> column<span class=\"token punctuation\">,</span> BaseModel <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@ioc:Adonis/Lucid/Orm'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Post</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseModel</span> <span class=\"token punctuation\">{</span>\n  @<span class=\"token function\">column</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">public</span> userId<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span>\n<span class=\"token punctuation\">}</span>\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"custom-foreign-key"},"children":[{"type":"element","tag":"a","props":{"href":"#custom-foreign-key","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Custom foreign key"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By default, the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"foreignKey"}]},{"type":"text","value":" is the camelCase representation of the "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"parent model name"}]},{"type":"text","value":" and its primary key."}]},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"Parent Model Name"}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"Primary Key"}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"Foreign Key"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"User"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"id"}]},{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"userId"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"However, you can also define a custom foreign key."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"@<span class=\"token function\">hasMany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Post<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  foreignKey<span class=\"token operator\">:</span> <span class=\"token string\">'authorId'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> posts<span class=\"token operator\">:</span> HasMany<span class=\"token operator\">&lt;</span><span class=\"token keyword\">typeof</span> Post<span class=\"token operator\">></span>\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"custom-local-key"},"children":[{"type":"element","tag":"a","props":{"href":"#custom-local-key","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Custom local key"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The local key is always the primary key of the "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"parent model"}]},{"type":"text","value":", but can be defined explicitly."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"@<span class=\"token function\">hasMany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Post<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  localKey<span class=\"token operator\">:</span> <span class=\"token string\">'uuid'</span><span class=\"token punctuation\">,</span>\n  foreignKey<span class=\"token operator\">:</span> <span class=\"token string\">'authorId'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> posts<span class=\"token operator\">:</span> HasMany<span class=\"token operator\">&lt;</span><span class=\"token keyword\">typeof</span> Post<span class=\"token operator\">></span>\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"table-structure"},"children":[{"type":"element","tag":"a","props":{"href":"#table-structure","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Table structure"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Following is an example table describing the relationship at the database level."}]},{"type":"element","tag":"div","props":{"className":["alert","alert-note"]},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Lucid models doesn't rely on the database level foreign key constraint. It just want the columns to be present and must be of same data types."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"src":"https://res.cloudinary.com/adonis-js/image/upload/q_auto,w_700,f_auto,fl_lossy/v1588083599/adonisjs.com/has-many.png"},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"preloading-relationship"},"children":[{"type":"element","tag":"a","props":{"href":"#preloading-relationship","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Preloading relationship"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The preloading API for a has many relationship is already covered in the "},{"type":"element","tag":"a","props":{"href":"/guides/model-relations/introduction#preloading-relationship"},"children":[{"type":"text","value":"introduction guide"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h2","props":{"id":"persisting-relationship"},"children":[{"type":"element","tag":"a","props":{"href":"#persisting-relationship","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Persisting relationship"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Along with the API covered in the "},{"type":"element","tag":"a","props":{"href":"/guides/model-relations/introduction#persisting-relations"},"children":[{"type":"text","value":"introduction guide"}]},{"type":"text","value":", a "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"has many"}]},{"type":"text","value":" relationship also has methods for persisting multiple rows."}]},{"type":"element","tag":"h3","props":{"id":"createmany"},"children":[{"type":"element","tag":"a","props":{"href":"#createmany","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"createMany"}]}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">const</span> posts <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">related</span><span class=\"token punctuation\">(</span><span class=\"token string\">'posts'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">createMany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    title<span class=\"token operator\">:</span> <span class=\"token string\">'Adonis 101'</span><span class=\"token punctuation\">,</span>\n    body<span class=\"token operator\">:</span> <span class=\"token string\">'Lorem Ipsum is simply dummy text'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    title<span class=\"token operator\">:</span> <span class=\"token string\">'NodeJS 101'</span><span class=\"token punctuation\">,</span>\n    body<span class=\"token operator\">:</span> <span class=\"token string\">'Lorem Ipsum is simply dummy text'</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"savemany"},"children":[{"type":"element","tag":"a","props":{"href":"#savemany","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"saveMany"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Similar to "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"createMany"}]},{"type":"text","value":", but instead accepts an array of related model instances."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">const</span> post <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Post</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\npost<span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> <span class=\"token string\">'Adonis 101'</span>\npost<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> <span class=\"token string\">'Lorem Ipsum is simply dummy text'</span>\n\n<span class=\"token keyword\">const</span> post1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Post</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\npost1<span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> <span class=\"token string\">'NodeJS 101'</span>\npost1<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> <span class=\"token string\">'Lorem Ipsum is simply dummy text'</span>\n\n<span class=\"token keyword\">const</span> posts <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">related</span><span class=\"token punctuation\">(</span><span class=\"token string\">'posts'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">saveMany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>post<span class=\"token punctuation\">,</span> post1<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"updateorcreatemany"},"children":[{"type":"element","tag":"a","props":{"href":"#updateorcreatemany","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"updateOrCreateMany"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"updateOrCreateMany"}]},{"type":"text","value":" method allows syncing rows by avoiding duplicate entries."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">const</span> posts <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">related</span><span class=\"token punctuation\">(</span><span class=\"token string\">'posts'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">updateOrCreateMany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    title<span class=\"token operator\">:</span> <span class=\"token string\">'Adonis 101'</span><span class=\"token punctuation\">,</span>\n    body<span class=\"token operator\">:</span> <span class=\"token string\">'Lorem Ipsum is simply dummy text'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    title<span class=\"token operator\">:</span> <span class=\"token string\">'NodeJS 101'</span><span class=\"token punctuation\">,</span>\n    body<span class=\"token operator\">:</span> <span class=\"token string\">'Lorem Ipsum is simply dummy text'</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If required you can also define additional keys to be used along with the foreign key to identify a row as unique."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In the following example, we want to sync the variants of a product making sure there is always one variant of a given color."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">const</span> product <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> Product<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> variants <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> product<span class=\"token punctuation\">.</span><span class=\"token function\">related</span><span class=\"token punctuation\">(</span><span class=\"token string\">'variants'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">updateOrCreateMany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    color<span class=\"token operator\">:</span> <span class=\"token string\">'green'</span><span class=\"token punctuation\">,</span>\n    price<span class=\"token operator\">:</span> <span class=\"token number\">3220</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    color<span class=\"token operator\">:</span> <span class=\"token string\">'red'</span><span class=\"token punctuation\">,</span>\n    price<span class=\"token operator\">:</span> <span class=\"token number\">3299</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    color<span class=\"token operator\">:</span> <span class=\"token string\">'white'</span><span class=\"token punctuation\">,</span>\n    price<span class=\"token operator\">:</span> <span class=\"token number\">3200</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'color'</span><span class=\"token punctuation\">)</span>\n"}]}]}]}]}
