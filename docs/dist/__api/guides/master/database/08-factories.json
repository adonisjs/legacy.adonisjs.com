{"type":"root","children":[{"type":"element","tag":"dimertitle","props":{},"children":[{"type":"text","value":"Model factories"}]},{"type":"element","tag":"h1","props":{"id":"model-factories"},"children":[{"type":"element","tag":"a","props":{"href":"#model-factories","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Model factories"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Have you ever written tests, in which the first "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"15-20 lines"}]},{"type":"text","value":" of each test are dedicated to just setting up the database state by using multiple models? With model factories, you can extract all this setup to a dedicated file and then write the bare minimum code to setup the database state."}]},{"type":"element","tag":"div","props":{"className":["toc-container"]},"children":[{"type":"element","tag":"h2","props":{},"children":[{"type":"text","value":"Table of contents"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#creating-factories"},"children":[{"type":"text","value":"Creating factories"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#using-factories"},"children":[{"type":"text","value":"Using factories"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#merging-attributes"},"children":[{"type":"text","value":"Merging attributes"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#factory-states"},"children":[{"type":"text","value":"Factory states"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#relationships"},"children":[{"type":"text","value":"Relationships"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#points-to-note"},"children":[{"type":"text","value":"Points to note"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#applying-relationship-states"},"children":[{"type":"text","value":"Applying relationship states"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#stubbing-database-calls"},"children":[{"type":"text","value":"Stubbing database calls"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#customizing-stub-id"},"children":[{"type":"text","value":"Customizing stub id"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#runtime-context"},"children":[{"type":"text","value":"Runtime context"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#hooks"},"children":[{"type":"text","value":"Hooks"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#custom-connections"},"children":[{"type":"text","value":"Custom connections"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#customizations"},"children":[{"type":"text","value":"Customizations"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#newup"},"children":[{"type":"text","value":"newUp"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#merge"},"children":[{"type":"text","value":"merge"}]}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By the end of this guide, you will know:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"How to create and use factories"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"How to define factory states"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Working with model relationships"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Using the faker API to generate and use random data"}]}]},{"type":"element","tag":"h2","props":{"id":"creating-factories"},"children":[{"type":"element","tag":"a","props":{"href":"#creating-factories","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Creating factories"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Model factories are stored inside "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"databases/factories"}]},{"type":"text","value":" directory. You can define all factories within a single file or create dedicated files for each model, the choice is yours."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Unlike seeders or models, the factories are declarative in nature as shown in the following example:"}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"database/factories/index.ts"}]},{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">import</span> Factory <span class=\"token keyword\">from</span> <span class=\"token string\">'@ioc:Adonis/Lucid/Factory'</span>\n<span class=\"token keyword\">import</span> User <span class=\"token keyword\">from</span> <span class=\"token string\">'App/Models/User'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> UserFactory <span class=\"token operator\">=</span> Factory\n  <span class=\"token punctuation\">.</span><span class=\"token function\">define</span><span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> faker <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      username<span class=\"token operator\">:</span> faker<span class=\"token punctuation\">.</span>internet<span class=\"token punctuation\">.</span><span class=\"token function\">userName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      email<span class=\"token operator\">:</span> faker<span class=\"token punctuation\">.</span>internet<span class=\"token punctuation\">.</span><span class=\"token function\">email</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      password<span class=\"token operator\">:</span> faker<span class=\"token punctuation\">.</span>internet<span class=\"token punctuation\">.</span><span class=\"token function\">password</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Factory.define"}]},{"type":"text","value":" method accepts a total of two arguments."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The first argument is reference to the Lucid model."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The second argument is a callback that returns an object of properties to be used when persisting the model instance. Make sure that you return an object with all the required properties, otherwise the database will raise "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"not null"}]},{"type":"text","value":" exceptions."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Finally, make sure to call the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"build"}]},{"type":"text","value":" method."}]}]},{"type":"element","tag":"h2","props":{"id":"using-factories"},"children":[{"type":"element","tag":"a","props":{"href":"#using-factories","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Using factories"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Using factories is quite simple. Just "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"import"}]},{"type":"text","value":" the file and use the exported factories."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> UserFactory <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'Database/factories'</span>\n\n<span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> UserFactory<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In order to create multiple instances, you can make use of the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"createMany"}]},{"type":"text","value":" method."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">const</span> users <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> UserFactory<span class=\"token punctuation\">.</span><span class=\"token function\">createMany</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"merging-attributes"},"children":[{"type":"element","tag":"a","props":{"href":"#merging-attributes","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Merging attributes"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can override the default set of attributes using the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":".merge"}]},{"type":"text","value":" method. For example:"}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">await</span> UserFactory\n  <span class=\"token punctuation\">.</span><span class=\"token function\">merge</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> email<span class=\"token operator\">:</span> <span class=\"token string\">'test@example.com'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When creating multiple instances, you can define an array of attributes and they will merge based upon their indexes. For example:"}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">await</span> UserFactory\n  <span class=\"token punctuation\">.</span><span class=\"token function\">merge</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span> email<span class=\"token operator\">:</span> <span class=\"token string\">'foo@example.com'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> email<span class=\"token operator\">:</span> <span class=\"token string\">'bar@example.com'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">createMany</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In the above example"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The first user will have the email of "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"foo@example.com"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The second user will have the email of "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"bar@example.com"}]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"And, the third user will use the default email address, since the merge array has a length of 2."}]}]},{"type":"element","tag":"h2","props":{"id":"factory-states"},"children":[{"type":"element","tag":"a","props":{"href":"#factory-states","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Factory states"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Factory states allows you to define variations of your factories as states. For example: On a "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Post"}]},{"type":"text","value":" factory, you can have different states to "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"represent published and draft posts"}]},{"type":"text","value":"."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">import</span> Factory <span class=\"token keyword\">from</span> <span class=\"token string\">'@ioc:Adonis/Lucid/Factory'</span>\n<span class=\"token keyword\">import</span> Post <span class=\"token keyword\">from</span> <span class=\"token string\">'App/Models/Post'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> PostFactory <span class=\"token operator\">=</span> Factory\n  <span class=\"token punctuation\">.</span><span class=\"token function\">define</span><span class=\"token punctuation\">(</span>Post<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> faker <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      title<span class=\"token operator\">:</span> faker<span class=\"token punctuation\">.</span>lorem<span class=\"token punctuation\">.</span><span class=\"token function\">sentence</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      content<span class=\"token operator\">:</span> faker<span class=\"token punctuation\">.</span>lorem<span class=\"token punctuation\">.</span><span class=\"token function\">paragraphs</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      status<span class=\"token operator\">:</span> <span class=\"token string\">'DRAFT'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">state</span><span class=\"token punctuation\">(</span><span class=\"token string\">'published'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> post<span class=\"token punctuation\">.</span>status <span class=\"token operator\">=</span> <span class=\"token string\">'PUBLISHED'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 👈</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By default, all posts will be created with "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"DRAFT"}]},{"type":"text","value":" status. However, you can explicitly apply the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"published"}]},{"type":"text","value":" state to create posts with "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"PUBLISHED"}]},{"type":"text","value":" status."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">await</span> <span class=\"token function\">PostFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token string\">'published'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">createMany</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">await</span> PostFactory<span class=\"token punctuation\">.</span><span class=\"token function\">createMany</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"relationships"},"children":[{"type":"element","tag":"a","props":{"href":"#relationships","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Relationships"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Model factories makes it super simple to work with relationships. Consider the following example:"}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> PostFactory <span class=\"token operator\">=</span> Factory\n  <span class=\"token punctuation\">.</span><span class=\"token function\">define</span><span class=\"token punctuation\">(</span>Post<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> faker <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      title<span class=\"token operator\">:</span> faker<span class=\"token punctuation\">.</span>lorem<span class=\"token punctuation\">.</span><span class=\"token function\">sentence</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      content<span class=\"token operator\">:</span> faker<span class=\"token punctuation\">.</span>lorem<span class=\"token punctuation\">.</span><span class=\"token function\">paragraphs</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      status<span class=\"token operator\">:</span> <span class=\"token string\">'DRAFT'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> UserFactory <span class=\"token operator\">=</span> Factory\n  <span class=\"token punctuation\">.</span><span class=\"token function\">define</span><span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> faker <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      username<span class=\"token operator\">:</span> faker<span class=\"token punctuation\">.</span>internet<span class=\"token punctuation\">.</span><span class=\"token function\">userName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      email<span class=\"token operator\">:</span> faker<span class=\"token punctuation\">.</span>internet<span class=\"token punctuation\">.</span><span class=\"token function\">email</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      password<span class=\"token operator\">:</span> faker<span class=\"token punctuation\">.</span>internet<span class=\"token punctuation\">.</span><span class=\"token function\">password</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">relation</span><span class=\"token punctuation\">(</span><span class=\"token string\">'posts'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> PostFactory<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 👈</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now, you can create a "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"user"}]},{"type":"text","value":" and its "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"posts"}]},{"type":"text","value":" all together in one call."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> UserFactory<span class=\"token punctuation\">.</span><span class=\"token keyword\">with</span><span class=\"token punctuation\">(</span><span class=\"token string\">'posts'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nuser<span class=\"token punctuation\">.</span>posts<span class=\"token punctuation\">.</span>length <span class=\"token comment\">// 3</span>\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"points-to-note"},"children":[{"type":"element","tag":"a","props":{"href":"#points-to-note","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Points to note"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The factory will find the type of relationship by inspecting the Lucid model. For example: If your model defines a "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"hasMany"}]},{"type":"text","value":" relationship on "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"posts"}]},{"type":"text","value":", then factory will infer the same."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"A relationship first needs to be defined on the model and then only it can be defined on the Factory."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Lucid will internally wrap all the database operations inside a transaction. So if a relationship persistance fails, the parent model persistance will be rolled back too."}]}]},{"type":"element","tag":"h3","props":{"id":"applying-relationship-states"},"children":[{"type":"element","tag":"a","props":{"href":"#applying-relationship-states","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Applying relationship states"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can also apply states on a relationship by passing a callback to the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"with"}]},{"type":"text","value":" method."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> UserFactory\n  <span class=\"token punctuation\">.</span><span class=\"token keyword\">with</span><span class=\"token punctuation\">(</span><span class=\"token string\">'posts'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">post</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token string\">'published'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Similarly, if you want, you can create few posts with the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"published"}]},{"type":"text","value":" state and few without it."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> UserFactory\n  <span class=\"token punctuation\">.</span><span class=\"token keyword\">with</span><span class=\"token punctuation\">(</span><span class=\"token string\">'posts'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">post</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token string\">'published'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token keyword\">with</span><span class=\"token punctuation\">(</span><span class=\"token string\">'posts'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nuser<span class=\"token punctuation\">.</span>posts<span class=\"token punctuation\">.</span>length <span class=\"token comment\">// 5</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Finally, you can also create nested relationships. For example: Create a user with "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"two posts"}]},{"type":"text","value":" and "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"five comments for each post"}]},{"type":"text","value":"."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> UserFactory\n  <span class=\"token punctuation\">.</span><span class=\"token keyword\">with</span><span class=\"token punctuation\">(</span><span class=\"token string\">'posts'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> post<span class=\"token punctuation\">.</span><span class=\"token keyword\">with</span><span class=\"token punctuation\">(</span><span class=\"token string\">'comments'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"stubbing-database-calls"},"children":[{"type":"element","tag":"a","props":{"href":"#stubbing-database-calls","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Stubbing database calls"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In some cases, you may prefer to stub out the database calls and just want to create in-memory model instances. This is can achieved using the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"makeStubbed"}]},{"type":"text","value":" and "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"makeStubbedMany"}]},{"type":"text","value":" methods."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> UserFactory\n  <span class=\"token punctuation\">.</span><span class=\"token keyword\">with</span><span class=\"token punctuation\">(</span><span class=\"token string\">'posts'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">makeStubbed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span> <span class=\"token comment\">// &lt;some-id></span>\n<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span>$isPersisted<span class=\"token punctuation\">)</span> <span class=\"token comment\">// false</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The stubbed calls will never hit the database and will assign an in-memory numeric "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"id"}]},{"type":"text","value":" to the model instances."}]},{"type":"element","tag":"h3","props":{"id":"customizing-stub-id"},"children":[{"type":"element","tag":"a","props":{"href":"#customizing-stub-id","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Customizing stub id"}]},{"type":"element","tag":"div","props":{"className":["alert","alert-note"]},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"When we say "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"id"}]},{"type":"text","value":". We mean the primary key of a model and not a fixed named attribute "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"id"}]},{"type":"text","value":"."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The stub id is just an in-memory counter, that keeps on increasing with every call. If required, you can define a custom method to generate stub ids in a different manner."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For example: Generating ids as a "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"BigInt"}]},{"type":"text","value":" when using PostgreSQL "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"bigInteger"}]},{"type":"text","value":" data type."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">import</span> Factory <span class=\"token keyword\">from</span> <span class=\"token string\">'@ioc:Adonis/Lucid/Factory'</span>\n\nFactory<span class=\"token punctuation\">.</span><span class=\"token function\">stubId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>counter<span class=\"token punctuation\">,</span> model<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">BigInt</span><span class=\"token punctuation\">(</span>counter<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can make use of the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"makeStubbed"}]},{"type":"text","value":" hook to customize the id generation behavior for an individual factory."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Factory\n  <span class=\"token punctuation\">.</span><span class=\"token function\">define</span><span class=\"token punctuation\">(</span>Post<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">before</span><span class=\"token punctuation\">(</span><span class=\"token string\">'makeStubbed'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">,</span> model<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    model<span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> uuid<span class=\"token punctuation\">.</span><span class=\"token function\">v4</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"runtime-context"},"children":[{"type":"element","tag":"a","props":{"href":"#runtime-context","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Runtime context"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Every time you create a model instance from a factory, a runtime context is also created at the same time. The context is then passed to all the hooks, the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"define"}]},{"type":"text","value":" method callback and also the relationships."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Most of the time, you just want to access the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"faker"}]},{"type":"text","value":" object from the context. However, following are the available properties."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"isStubbed"}]},{"type":"text","value":": A boolean to know, if the factory was instantiated in stub mode."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"$trx"}]},{"type":"text","value":": A transaction object, under which all the database operations are wrapped. If you are running any database queries inside the factory hooks, then make sure to also wrap them inside the transaction."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Following is an example showcasing the callbacks that receives the runtime context "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"(ctx)"}]},{"type":"text","value":"."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Factory\n  <span class=\"token punctuation\">.</span><span class=\"token function\">define</span><span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">before</span><span class=\"token punctuation\">(</span><span class=\"token string\">'create'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>factory<span class=\"token punctuation\">,</span> model<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">after</span><span class=\"token punctuation\">(</span><span class=\"token string\">'create'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>factory<span class=\"token punctuation\">,</span> model<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">state</span><span class=\"token punctuation\">(</span><span class=\"token string\">'admin'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"hooks"},"children":[{"type":"element","tag":"a","props":{"href":"#hooks","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Hooks"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The factory exposes the following hooks to perform actions "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"before"}]},{"type":"text","value":" or "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"after"}]},{"type":"text","value":" certain events. You can also define multiple hooks for a single event."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Factory\n  <span class=\"token punctuation\">.</span><span class=\"token function\">define</span><span class=\"token punctuation\">(</span>Post<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">before</span><span class=\"token punctuation\">(</span><span class=\"token string\">'create'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">after</span><span class=\"token punctuation\">(</span><span class=\"token string\">'create'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"Lifecycle"}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"Event"}]},{"type":"element","tag":"th","props":{},"children":[{"type":"text","value":"Description"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"before"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"create"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"Invoked "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"before the insert"}]},{"type":"text","value":" query."}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"after"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"create"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"Invoked "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"after the insert"}]},{"type":"text","value":" query."}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"before"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"makeStubbed"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"Invoked "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"before the stubbed"}]},{"type":"text","value":" call."}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"after"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"makeStubbed"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"Invoked "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"after the stubbed"}]},{"type":"text","value":" call."}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"after"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"make"}]}]},{"type":"element","tag":"td","props":{},"children":[{"type":"text","value":"Invoked only "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"after"}]},{"type":"text","value":" the model instance has been created. This hook is also invoked before the "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"before create"}]},{"type":"text","value":" and "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"before makeStubbed"}]},{"type":"text","value":" hooks."}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"custom-connections"},"children":[{"type":"element","tag":"a","props":{"href":"#custom-connections","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Custom connections"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Factories allows you to define a custom connection or query client at the time using them. For example:"}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">await</span> Factory<span class=\"token punctuation\">.</span><span class=\"token function\">connection</span><span class=\"token punctuation\">(</span><span class=\"token string\">'tenant-1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Also, you can pass a custom query client instance."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">const</span> queryClient <span class=\"token operator\">=</span> Database<span class=\"token punctuation\">.</span><span class=\"token function\">connection</span><span class=\"token punctuation\">(</span><span class=\"token string\">'tenant-1'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">await</span> Factory<span class=\"token punctuation\">.</span><span class=\"token function\">client</span><span class=\"token punctuation\">(</span>queryClient<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For the sake of API uniformity among the factories and the Lucid models, you can also define the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"connection"}]},{"type":"text","value":" or the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"client"}]},{"type":"text","value":" using the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"query"}]},{"type":"text","value":" method."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">await</span> Factory<span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> connection<span class=\"token operator\">:</span> <span class=\"token string\">'tenant-1'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"customizations"},"children":[{"type":"element","tag":"a","props":{"href":"#customizations","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Customizations"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Finally, you can optionally customize the behavior of certain operations performed under the hood."}]},{"type":"element","tag":"h3","props":{"id":"newup"},"children":[{"type":"element","tag":"a","props":{"href":"#newup","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"newUp"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By defining the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"newUp"}]},{"type":"text","value":" handler, you can customize the process of instantiating a model instance for a given factory."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Factory\n  <span class=\"token punctuation\">.</span><span class=\"token function\">define</span><span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">newUp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>attributes<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    user<span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span>attributes<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> user\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"merge"},"children":[{"type":"element","tag":"a","props":{"href":"#merge","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"merge"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By defining the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"merge"}]},{"type":"text","value":" handler, you can customize the merge behavior."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Factory\n  <span class=\"token punctuation\">.</span><span class=\"token function\">define</span><span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">merge</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span> attributes<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    user<span class=\"token punctuation\">.</span><span class=\"token function\">merge</span><span class=\"token punctuation\">(</span>attributes<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n"}]}]}]}]}
