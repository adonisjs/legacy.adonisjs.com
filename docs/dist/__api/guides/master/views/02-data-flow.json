{"type":"root","children":[{"type":"element","tag":"dimertitle","props":{},"children":[{"type":"text","value":"Data Flow"}]},{"type":"element","tag":"h1","props":{"id":"data-flow"},"children":[{"type":"element","tag":"a","props":{"href":"#data-flow","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Data Flow"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can pass data to the templates at different stages and each stage defines the scope at which the data will be accessible inside the templates. By the end this guide, you will know:"}]},{"type":"element","tag":"div","props":{"className":["toc-container"]},"children":[{"type":"element","tag":"h2","props":{},"children":[{"type":"text","value":"Table of contents"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#template-state"},"children":[{"type":"text","value":"Template State"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#global-state"},"children":[{"type":"text","value":"Global State"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#defining-globals"},"children":[{"type":"text","value":"Defining globals"}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#shared-state"},"children":[{"type":"text","value":"Shared State"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"#conclusion"},"children":[{"type":"text","value":"Conclusion"}]}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Different API's to pass data to a template"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The scope of data at which it is accessible to the templates"}]}]},{"type":"element","tag":"h2","props":{"id":"template-state"},"children":[{"type":"element","tag":"a","props":{"href":"#template-state","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Template State"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The most common way to pass data to a template is during the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"view.render"}]},{"type":"text","value":" call. This data object is known as the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"state"}]},{"type":"text","value":" of the template."}]},{"type":"element","tag":"div","props":{"className":["tabs"]},"children":[{"type":"element","tag":"div","props":{"className":["tab-head"]},"children":[{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{"dataTitle":"tab-1"},"children":[{"type":"text","value":"Rendering View"}]},{"type":"element","tag":"li","props":{"dataTitle":"tab-2"},"children":[{"type":"text","value":"Template"}]}]}]},{"type":"element","tag":"div","props":{"className":["tab-body"]},"children":[{"type":"element","tag":"div","props":{"className":["tab-item"],"id":"tab-1"},"children":[{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"Rendering View"}]},{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Route<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'users/:id'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> view <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"dimer-highlight-code-line\">  <span class=\"token keyword\">const</span> state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span></span><span class=\"dimer-highlight-code-line\">    user<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span></span><span class=\"dimer-highlight-code-line\">      id<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></span><span class=\"dimer-highlight-code-line\">      username<span class=\"token operator\">:</span> <span class=\"token string\">'virk'</span><span class=\"token punctuation\">,</span></span><span class=\"dimer-highlight-code-line\">    <span class=\"token punctuation\">}</span></span><span class=\"dimer-highlight-code-line\">  <span class=\"token punctuation\">}</span></span><span class=\"dimer-highlight-code-line\">  </span><span class=\"dimer-highlight-code-line\">  <span class=\"token keyword\">return</span> view<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token string\">'users/show'</span><span class=\"token punctuation\">,</span> state<span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n"}]}]}]}]},{"type":"element","tag":"div","props":{"className":["tab-item"],"id":"tab-2"},"children":[{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"Template"}]},{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token operator\">&lt;</span>p<span class=\"token operator\">></span> Hello <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> user<span class=\"token punctuation\">.</span>username <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>p<span class=\"token operator\">></span>\n"}]}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The state of the template is shared among the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"partials"}]},{"type":"text","value":" and the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"layout"}]},{"type":"text","value":", but not with the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"components"}]},{"type":"text","value":", since components have their own state."}]},{"type":"element","tag":"h2","props":{"id":"global-state"},"children":[{"type":"element","tag":"a","props":{"href":"#global-state","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Global State"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Templates also have a global state, which is shared among all the templates and "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"even the components"}]},{"type":"text","value":". This is a great place to store the helper methods or some shared configuration."}]},{"type":"element","tag":"h3","props":{"id":"defining-globals"},"children":[{"type":"element","tag":"a","props":{"href":"#defining-globals","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Defining globals"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The globals must be defined only once. So keeping them inside a provider is a great option. Open "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"providers/AppProvider.ts"}]},{"type":"text","value":" file and paste the following code snippet inside it."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> IocContract <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@adonisjs/fold'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppProvider</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">constructor</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">protected</span> $container<span class=\"token operator\">:</span> IocContract<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">async</span> <span class=\"token function\">boot</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> View <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">await</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@ioc:Adonis/Core/View'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">default</span>\n<span class=\"dimer-highlight-code-line\">    View<span class=\"token punctuation\">.</span><span class=\"token function\">global</span><span class=\"token punctuation\">(</span><span class=\"token string\">'timestamp'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"dimer-highlight-code-line\">      <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></span><span class=\"dimer-highlight-code-line\">    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></span>  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now, you can access the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"timestamp"}]},{"type":"text","value":" method inside your templates."}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-edge","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token other\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span> The current timestamp is</span> <span class=\"token mustache\"><span class=\"token punctuation\">{{</span> timestamp() <span class=\"token punctuation\">}}</span></span> <span class=\"token other\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span></span>\n"}]}]}]},{"type":"element","tag":"h2","props":{"id":"shared-state"},"children":[{"type":"element","tag":"a","props":{"href":"#shared-state","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Shared State"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Finally, the templates can also have shared state. The shared state is similar to globals, but it is specific to a single instance of a view. The shared state is helpful, when you want to have globals, but isolated between HTTP requests."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For example: The "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"request"}]},{"type":"text","value":" and "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"auth"}]},{"type":"text","value":" variables added by AdonisJS are part of the shared state."}]},{"type":"element","tag":"div","props":{"className":["tabs"]},"children":[{"type":"element","tag":"div","props":{"className":["tab-head"]},"children":[{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{"dataTitle":"tab-1"},"children":[{"type":"text","value":"Sharing data"}]},{"type":"element","tag":"li","props":{"dataTitle":"tab-2"},"children":[{"type":"text","value":"Rendering View"}]}]}]},{"type":"element","tag":"div","props":{"className":["tab-body"]},"children":[{"type":"element","tag":"div","props":{"className":["tab-item"],"id":"tab-1"},"children":[{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"Sharing data"}]},{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"],"dataLine":"2"},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Route<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> view<span class=\"token punctuation\">,</span> request <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"dimer-highlight-code-line\">  view<span class=\"token punctuation\">.</span><span class=\"token function\">share</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> locale<span class=\"token operator\">:</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">language</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'en'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'fr'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'it'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></span>\n  <span class=\"token keyword\">return</span> view<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n"}]}]}]}]},{"type":"element","tag":"div","props":{"className":["tab-item"],"id":"tab-2"},"children":[{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"span","props":{"className":["filename"]},"children":[{"type":"text","value":"Rendering View"}]},{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token operator\">&lt;</span>p<span class=\"token operator\">></span> The current request locale <span class=\"token keyword\">is</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> locale <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>p<span class=\"token operator\">></span>\n"}]}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The above example uses a Route for simpler explaination. However, you can "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"share"}]},{"type":"text","value":" data from middleware as well and it will be isolated among multiple HTTP requests."}]},{"type":"element","tag":"h2","props":{"id":"conclusion"},"children":[{"type":"element","tag":"a","props":{"href":"#conclusion","aria-hidden":true},"children":[{"type":"element","tag":"span","props":{"className":["icon","icon-link"]},"children":[]}]},{"type":"text","value":"Conclusion"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Before passing all the data to a template, Edge will deep merge all these objects in the following order."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Globals"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Shared state"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Template state"}]}]},{"type":"element","tag":"div","props":{"className":["dimer-highlight"]},"children":[{"type":"element","tag":"pre","props":{"className":["language-ts","line-numbers"]},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"<span class=\"token keyword\">const</span> finalState <span class=\"token operator\">=</span> <span class=\"token function\">deepMerge</span><span class=\"token punctuation\">(</span>globals<span class=\"token punctuation\">,</span> sharedState<span class=\"token punctuation\">,</span> templateState<span class=\"token punctuation\">)</span>\n"}]}]}]}]}
